var ccd3=function(){"use strict";var a={version:"0.9.6"};return a.instances={},a.get_instance=function(b){return"string"==typeof b?a.instances[b]:a.instances[d3.select(b.farthestViewportElement).attr("id").replace(/^svg_/g,"")]},a.env={},a.env.isIE=function(){return-1!=window.navigator.userAgent.toLowerCase().indexOf("msie")?!0:!1}(),a.options={},a.options.echo_script="server/echo_csv.php",a.options.ccd3_path=function(){var a=document.getElementsByTagName("script"),b=a[a.length-1].src,c=b.split("/");return 1==c.length?b:(c[c.length-1]="",c.join("/"))}(),a.options.csv_echo_path=function(){return a.options.ccd3_path+a.options.echo_script},a.Chart=function(b,c){this.div_id=b,a.instances[b]=this,this.series_container={},this.title={},this.xLabel={},this.yLabel={},this.xAxis={},this.yAxis={},this.rAxis={},this.aAxis={},this.legend={show:!0},this.tooltip={show:!0},this.menu={show:!0},this.zoom={use:!0},this.event_layer={},this.series=[],this.series_options={};for(var d in a.Parts.Series.type_info())this.series_options[d]={};this.dataset_manager={},this.initialized=!1,this.color_palette=void 0,this.height=320,this.width=480,this.auto_resize=!1,this.chart_pattern=void 0,this.direction=void 0,this.show_values="onzoom",this.zoomed=!1,this.default_series_type="scatter",this.stack_type="zero",this.loader=new a.DatasetLoader(this),void 0!==c&&(this.dataset=c)},a.Chart.prototype.setup_options=function(b){return a.Util.merge(this,b)},a.Chart.prototype.set_dataset=function(a){this.dataset=a,this.initialized=!1},a.Chart.prototype.resize=function(){this.width=d3.select("#"+this.div_id)[0][0].clientWidth||this.width,this.initialized=!1},a.Chart.prototype.render=function(b){if(void 0===b&&(b={}),this.auto_resize){this.resize();var c=this;d3.select(window).on("resize."+this.div_id,function(){c.resize(),c.render({dont_recalc_dataset:!0,dont_reset_domain:!0})})}this.initialized||this.init(b),b.dont_recalc_dataset||(this.dataset_manager.build_lookup_table("x"),this.dataset_manager.build_lookup_table("y"),this.dataset_manager.update_stack_values(this.direction,this.stack_type));var d,e;if("xy"===this.chart_pattern)b.dont_reset_domain||(this.xAxis.reset_domain(),this.yAxis.reset_domain()),this.xAxis.reset_range(this.inner_width),this.yAxis.reset_range(this.inner_height),this.xAxis.render(),this.yAxis.render(),e=10,this.inner_width=this.width-this.yLabel.sizeof("width")-this.yAxis.sizeof("label_width")-e,d=23,this.title.sizeof("height")<d&&(this.title.height=d),this.legend.render(this.inner_width),this.legend.arrange(this.yAxis.sizeof("label_width")+this.yLabel.sizeof("width"),this.title.sizeof("height")),this.inner_height=this.height-this.title.sizeof("height")-this.legend.sizeof("height")-this.xAxis.sizeof("label_height")-this.xLabel.sizeof("height"),this.xAxis.arrange(this.yLabel.sizeof("width")+this.yAxis.sizeof("label_width"),this.height-this.xAxis.sizeof("label_height")-this.xLabel.sizeof("height")),this.yAxis.arrange(this.yLabel.sizeof("width")+this.yAxis.sizeof("label_width"),this.title.sizeof("height")+this.legend.sizeof("height")),this.series_container.render(this.inner_width,this.inner_height),this.series_container.arrange(this.yLabel.sizeof("width")+this.yAxis.sizeof("label_width"),this.title.sizeof("height")+this.legend.sizeof("height")),this.event_layer=new a.Parts.EventLayer(this,this.event_layer),this.event_layer.render(),this.zoom instanceof a.Parts||this.zoom.use&&"ordinal"!==this.xAxis.scale_type&&"ordinal"!==this.yAxis.scale_type&&(this.zoom=new a.Parts.Zoom(this,this.zoom)),this.xAxis.reset_range(this.inner_width),this.yAxis.reset_range(this.inner_height),this.yAxis.render(),this.xAxis.render();else if("ra"===this.chart_pattern){d=23,this.title.sizeof("height")<d&&(this.title.height=d);var f=Math.min(this.height,this.width);this.legend.render(f),this.inner_width=this.width,this.inner_height=this.height-this.title.sizeof("height")-this.legend.sizeof("height");var g=Math.min(this.inner_height,this.inner_width)/2;this.title.arrange(this.width/2,(this.inner_height-2*g)/2),this.legend.arrange((this.width-f)/2,(this.inner_height-2*g)/2+this.title.sizeof("height")),b.dont_reset_domain||(this.rAxis.reset_domain(),this.aAxis.reset_domain()),this.rAxis.reset_range(g),this.aAxis.reset_range(g),this.rAxis.render(),this.aAxis.render(),this.series_container.render(this.inner_width,this.inner_height),this.series_container.arrange(0,this.title.sizeof("height")+this.legend.sizeof("height")),this.rAxis.arrange(this.inner_width/2,this.inner_height/2+this.title.sizeof("height")+this.legend.sizeof("height")),this.aAxis.arrange(this.inner_width/2,this.inner_height/2+this.title.sizeof("height")+this.legend.sizeof("height"))}else"r"===this.chart_pattern&&(this.inner_width=this.width,this.inner_height=this.height-this.title.sizeof("height"),this.series_container.render(this.inner_width,this.inner_height),this.series_container.arrange(0,this.title.sizeof("height")));this.tooltip instanceof a.Parts||(this.tooltip.show?this.tooltip=new a.Parts.Tooltip(this,this.tooltip):this.tooltip.add_listener=function(){}),this.render_series(),this.menu.render(),this.zoom instanceof a.Parts&&this.zoomed&&this.zoom.rearrange_reset_button()},a.Chart.prototype.sort_domain=function(a,b,c){var d=this[a+"Axis"].scale.domain(),e=this.dataset_manager.get_axis_sum(a,b);d.sort(function(a,b){return(e[b]-e[a])*(c?-1:1)}),this[a+"Axis"].scale.domain(d),this.render({dont_reset_domain:!0})},a.Chart.prototype.init=function(b){if(this.color_palette||(this.color_palette=["#3498db","#e74c3c","#2ecc71","#f1c40f","#e67e22","#1abc9c","#2980b9","#c0392b","#27ae60","#f39c12","#d35400","#16a085"]),b.dont_recalc_dataset||(this.dataset_manager instanceof a.DatasetManager||(this.dataset_manager=new a.DatasetManager(this,this.dataset_manager)),this.dataset=this.dataset_manager.setup(this.dataset),this.setup_options(this.dataset_manager.options_from_dataset()),this.chart_pattern=this.dataset_manager.detect_chart_pattern()),void 0===this.svg&&(this.svg=d3.select("#"+this.div_id).append("svg").attr("id","svg_"+this.div_id).attr("class","ccd3").attr("overflow","hidden")),this.svg.attr("width",this.width).attr("height",this.height),this.inner_width=this.width,this.inner_height=this.height,this.init_parts(),this.title.render(),this.title.arrange(this.width/2,this.title.margin_top),"xy"===this.chart_pattern){this.xLabel.render(),this.yLabel.render(),this.xLabel.arrange(this.width/2,this.height-this.xLabel.text_height-this.xLabel.margin_bottom),this.yLabel.arrange(this.yLabel.margin_left,this.height/2),this.xAxis.scale_type=this.dataset_manager.detect_scale_type(function(a){return a.x}),this.xAxis.min_step=this.dataset_manager.calc_min_step(function(a){return a.x})||2,this.yAxis.scale_type=this.dataset_manager.detect_scale_type(function(a){return a.y}),this.yAxis.min_step=this.dataset_manager.calc_min_step(function(a){return a.y})||2;var c=this.dataset_manager.has_directive_series_type();this.direction=c||"linear"!==this.yAxis.scale_type||"linear"!==this.xAxis.scale_type?"ordinal"===this.yAxis.scale_type||"date"===this.yAxis.scale_type?"y":"x":null,this.xAxis.init_scale(),this.yAxis.init_scale();var d=this.dataset_manager.detect_scale_type(function(a){return a.z}),e=this.dataset_manager.has_single_series_type("bar")||this.dataset_manager.has_single_series_type("stackedbar")||this.dataset_manager.has_single_series_type("heatmap");"ordinal"==this.xAxis.scale_type&&e&&("linear"===this.yAxis.scale_type&&this.menu.add_menu({func:function(a){this.sort_domain("x","y",a.asc),a.asc=!a.asc},label:"Sort X By Y"},"sort_x_by_y"),"linear"===d&&this.menu.add_menu({func:function(a){this.sort_domain("x","z",a.asc),a.asc=!a.asc},label:"Sort X By Z"},"sort_x_by_z")),"ordinal"==this.yAxis.scale_type&&e&&("linear"===this.xAxis.scale_type&&this.menu.add_menu({func:function(a){this.sort_domain("y","x",a.asc),a.asc=!a.asc},label:"Sort Y By X"},"sort_y_by_x"),"linear"===d&&this.menu.add_menu({func:function(a){this.sort_domain("y","z",a.asc),a.asc=!a.asc},label:"Sort Y By Z"},"sort_y_by_z"))}else"r"===this.chart_pattern?this.menu.add_menu({func:function(){this.series[0].sort=void 0===this.series[0].sort||"asc"==this.series[0].sort?"desc":"asc",this.render({dont_reset_domain:!0})},label:"Sort"},"sort"):"ra"===this.chart_pattern&&(this.rAxis.init_scale(),this.aAxis.init_scale());this.initialized=!0},a.Chart.prototype.init_parts=function(){this.series_container instanceof a.Parts||(this.series_container=new a.Parts.SeriesContainer(this,this.series_container)),this.title instanceof a.Parts||(this.title=void 0===this.title.text?new a.Parts(this,this.title):new a.Parts.Label.Title(this,this.title)),this.menu instanceof a.Parts||(this.menu.show?this.menu=new a.Parts.Menu(this,this.menu):(this.menu=new a.Parts(this,this.menu),this.menu.add_menu=function(){})),"xy"===this.chart_pattern?(this.xLabel instanceof a.Parts||(this.xLabel=void 0===this.xLabel.text?new a.Parts(this,this.xLabel):new a.Parts.Label.xLabel(this,this.xLabel)),this.yLabel instanceof a.Parts||(this.yLabel=void 0===this.yLabel.text?new a.Parts(this,this.yLabel):new a.Parts.Label.yLabel(this,this.yLabel)),this.xAxis instanceof a.Parts||(this.xAxis=new a.Parts.Axis.xAxis(this,this.xAxis)),this.yAxis instanceof a.Parts||(this.yAxis=new a.Parts.Axis.yAxis(this,this.yAxis)),this.lgend instanceof a.Parts||(this.legend=this.legend.show?new a.Parts.Legend(this,this.legend):new a.Parts(this,this.legend))):"ra"===this.chart_pattern&&(this.rAxis instanceof a.Parts||(this.rAxis=new a.Parts.rAxis(this,this.rAxis)),this.aAxis instanceof a.Parts||(this.aAxis=new a.Parts.aAxis(this,this.aAxis)),this.lgend instanceof a.Parts||(this.legend=this.legend.show?new a.Parts.Legend(this,this.legend):new a.Parts(this,this.legend)))},a.Chart.prototype.render_series=function(){var b,c,d,e,f=this.dataset,g=a.Parts.Series.type_info();for(d=this.dataset.length,e=this.series.length,b=Math.max(d,e),c=0;b>c;c++)d>c?(this.series[c]instanceof a.Parts.Series||(this.series[c]=new g[f[c].series_type].obj(this,this.series_options[f[c].series_type])),this.series[c].init_svg(this.dataset[c])):this.series[c].destroy();this.series.length=d,this.series_container.svg.selectAll(".ccd3_series").sort();var h=0;for(c=0;d>c;c++)"bar"===f[c].series_type&&f[c].visible&&h++;var i=0;for(c=0;d>c;c++)"bar"===f[c].series_type&&(this.series[c].render(h,i),f[c].visible&&i++);for(c=0;d>c;c++)"bar"!==f[c].series_type&&this.series[c].render()},a.Chart.prototype.destroy=function(){d3.select("#"+this.div_id).selectAll("*").remove(),d3.select("#tooltip_"+this.div_id).remove()},a.Chart.prototype._color=function(a){return this.color_palette[a%this.color_palette.length]},a.Parts=function(a,b){this.init(a,b)},a.Parts.prototype.get_defaults=function(){return{arrange_x:null,arrange_y:null}},a.Parts.prototype.init=function(a,b){var c,d=this.get_defaults();this.chart=a;for(c in b)b.hasOwnProperty(c)&&(this[c]=b[c]);for(c in d)this.hasOwnProperty(c)||(this[c]=d[c])},a.Parts.prototype.render=function(){},a.Parts.prototype.sizeof=function(a){return isNaN(this[a])?0:this[a]},a.Parts.prototype.arrange=function(a,b){this.svg&&(this.arrange_x=a,this.arrange_y=b,this.svg.attr("transform","translate("+a+","+b+")"))},a.Parts.SeriesContainer=function(){a.Parts.apply(this,arguments)},a.Parts.SeriesContainer.prototype=new a.Parts,a.Parts.SeriesContainer.prototype.get_defaults=function(){return{height:0,width:0}},a.Parts.SeriesContainer.prototype.render=function(a,b){this.width=a,this.height=b,this.svg||(this.svg=this.chart.svg.append("g").attr("class","ccd3_series_container").attr("clip-path","url(#"+this.chart.div_id+"_clip)"),this.clip_path=this.chart.svg.append("defs").append("clipPath").attr("id",this.chart.div_id+"_clip"),this.clip_path.append("rect")),this.svg.attr("width",this.width).attr("height",this.height),this.clip_path.select("rect").attr("width",this.width).attr("height",this.height)},a.Parts.Label=function(){a.Parts.apply(this,arguments)},a.Parts.Label.prototype=new a.Parts,a.Parts.Label.prototype.get_defaults=function(){return{class_name:"ccd3_label",text:null,text_anchor:"middle",rotate:0,font_size:10,margin_top:3,margin_bottom:3,margin_right:3,margin_left:3,text_height:0,text_width:0,height:0,width:0}},a.Parts.Label.prototype.render=function(){void 0===this.svg&&(this.svg=this.chart.svg.append("g"),this.svg.attr("class",this.class_name).append("text").attr("text-anchor",this.text_anchor)),this.svg.select("text").text(this.text).attr("font-size",this.font_size).attr("transform","translate(0,"+this.font_size+") rotate("+this.rotate+")"),this.text_height=this.svg[0][0].getBBox().height,this.text_width=this.svg[0][0].getBBox().width,this.height=this.text_height+this.margin_bottom+this.margin_top,this.width=this.text_width+this.margin_right+this.margin_left},a.Parts.Label.Title=function(){a.Parts.Label.apply(this,arguments)},a.Parts.Label.Title.prototype=new a.Parts.Label,a.Parts.Label.Title.prototype.get_defaults=function(){return{class_name:"ccd3_title",font_size:18,margin_bottom:5}},a.Parts.Label.xLabel=function(){a.Parts.Label.apply(this,arguments)},a.Parts.Label.xLabel.prototype=new a.Parts.Label,a.Parts.Label.xLabel.prototype.get_defaults=function(){return{class_name:"ccd3_xLabel",margin_bottom:10,font_size:10}},a.Parts.Label.yLabel=function(){a.Parts.Label.apply(this,arguments)},a.Parts.Label.yLabel.prototype=new a.Parts.Label,a.Parts.Label.yLabel.prototype.get_defaults=function(){return{class_name:"ccd3_yLabel",margin_left:10,font_size:10,rotate:90}},a.Parts.Legend=function(){a.Parts.apply(this,arguments)},a.Parts.Legend.prototype=new a.Parts,a.Parts.Legend.prototype.get_defaults=function(){return{show:!0,font_size:10,margin_top:1,margin_bottom:1,margin_left:5,margin_right:5,legend_height:0,height:0}},a.Parts.Legend.prototype.render=function(a){var b=this.chart.dataset,c=this;this.width=a;for(var d=[],e=0,f=b.length;f>e;e++)d.push(b[e].series_num);void 0===this.svg&&(this.svg=this.chart.svg.append("g").attr("class","ccd3_legend"));var g=this.svg.select(".legend_items");g.empty()&&(g=this.svg.append("g").attr("class","legend_items"));var h=g.selectAll("g").data(d);h.enter().append("g").attr("class","legend_item").attr("id",function(a){return"legend_item_"+a}).attr("cursor","pointer").on("click",function(){var a=d3.select(this).data();c.toggle_series(a)}).on("mouseover",function(){var a=d3.select(this).data();c.chart.series[a].highlight_series(!0)}).on("mouseout",function(){var a=d3.select(this).data();c.chart.series[a].highlight_series(!1)}).call(function(a){a.append("rect").attr("height","0.6em").attr("width","0.6em").attr("fill",function(a){return c.chart._color(a)}).attr("y","0.2em").attr("x","0.0em").attr("font-size",c.font_size)}).call(function(a){a.append("text").attr("y","0.8em").attr("x","0.8em").attr("font-size",c.font_size)}),h.select("rect").attr("visibility",function(a,c){return b[c].visible?"visible":"hidden"}),h.select("text").text(function(a,c){return b[c].name});var i=0,j=0,k=a;h.attr("transform",function(){var a=this.getBBox().height,b=this.previousSibling?this.previousSibling.getBBox().width:0;return i+2*(b+c.margin_right)<k?i+=b+c.margin_right:(i=c.margin_right,j+=a),"translate("+i+","+j+")"}),h.exit().remove(),this.legend_height=this.svg[0][0].getBBox().height,this.height=this.legend_height+this.margin_top+this.margin_bottom},a.Parts.Legend.prototype.toggle_series=function(a){var b=this.chart.dataset;b[a].visible=!b[a].visible,this.chart.svg.selectAll(".ccd3_zoom_reset_button").remove(),this.chart.zoomed=!1,this.chart.render()},a.Parts.Tooltip=function(){a.Parts.apply(this,arguments),this.render()},a.Parts.Tooltip.prototype=new a.Parts,a.Parts.Tooltip.prototype.get_defaults=function(){return{show:!0,axis_scan:!0,show_scan_line:!0,scan_line_width:3,font_size:10,xFormat:void 0,yFormat:void 0,zFormat:void 0,annotation_func:function(){return""}}},a.Parts.Tooltip.prototype.render=function(){if(void 0===this.div){this.xFormat=this.xFormat||this.chart.xAxis.format||this.chart.aAxis.format,this.yFormat=this.yFormat||this.chart.yAxis.format||this.chart.rAxis.format,this.div=d3.select("body").append("div").attr("id","tooltip_"+this.chart.div_id).attr("class","ccd3_tooltip").style("opacity",0),this.svg=this.div,this.font_size&&this.div.style("font-size",this.font_size+"px"),this.chart.event_layer.svg&&this.axis_scan&&("x"==this.chart.direction||"y"==this.chart.direction)&&(this.chart.event_layer.svg.call(this.add_axis_tooltip_listener,this),this.show_scan_line&&this.chart.event_layer.svg.insert("rect",".ccd3_zoom").attr("visibility","none").attr("class","ccd3_axis_scan_line").attr("fill","gray").attr("opacity",.2))}},a.Parts.Tooltip.prototype.add_listener=function(b,c){b.on("mouseover.tooltip",function(a){var b=d3.select(this.parentNode).data()[0]%1e3;c.div.html(c.chart.series[b].tooltip_html(a)+c.annotation_func(a)).style("display",null).style("opacity",.8)}),b.on("mouseout.tooltip",function(){a.get_instance(this).tooltip.div.style("opacity",0).style("display","none")}),b.on("mousemove.tooltip",function(){a.get_instance(this).tooltip.div.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+15+"px")})},a.Parts.Tooltip.prototype.add_axis_tooltip_listener=function(b,c){var d,e;b.on("mouseover.axis_tooltip",function(){c.chart.tooltip.div.style("display",null).style("opacity",.8),c.chart.event_layer.svg.select(".ccd3_axis_scan_line").attr("visibility","visible"),d=null,e=null}),b.on("mouseout.axis_tooltip",function(){a.get_instance(this).tooltip.div.style("opacity",0).style("display","none");for(var b=0;b<c.chart.series.length;b++)c.chart.series[b].highlight({});c.chart.event_layer.svg.select(".ccd3_axis_scan_line").attr("visibility","hidden"),d=null,e=null}),"x"==c.chart.direction?b.on("mousemove.axis_tooltip",function(){var b=c.chart.xAxis,e=d3.mouse(c.chart.event_layer.svg[0][0]),f=e[0],g=e[1];a.env.isIE&&(f=d3.event.offsetX,g=d3.event.offsetY);var h,i,j;if("ordinal"==b.scale_type){var k=b.scale.range();for(j=b.scale.rangeBand(),i=0;f>k[i]+j;i++);h=b.scale.domain()[i]}else h=b.scale.invert(f);if(c.div.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+15+"px"),d!=h){d=h;var l=c.chart.dataset_manager.lookup("x",h,!0);for(i=0;i<l.length;i++)c.chart.series[l[i].series_num].highlight(l[i]);var m="";for(m+="<b>"+c.xFormat(l[0].x)+"</b>",i=0;i<l.length;i++)m+="<br/><span style='color:"+c.chart._color(l[i].series_num)+";'>&#8226;</span> ",m+=l[i].series_name+": "+c.yFormat(l[i].y);if(c.div.html(m),c.show_scan_line){(c.chart.dataset_manager.has_series_type("bar")||c.chart.dataset_manager.has_series_type("stackedbar"))&&(c.scan_line_width="ordinal"==b.scale_type?b.scale.rangeBand()*(1+b.band_padding):b.scale(b.min_step)-b.scale(0));var n=b.scale(l[0].x)-c.scan_line_width/2+("ordinal"==b.scale_type?j/2:0);c.chart.event_layer.svg.select(".ccd3_axis_scan_line").attr("x",n).attr("width",c.scan_line_width).attr("y",0).attr("height",c.chart.inner_height).attr("visibility","visible")}}}):"y"==c.chart.direction&&b.on("mousemove.axis_tooltip",function(){var b=c.chart.yAxis,d=d3.mouse(c.chart.event_layer.svg[0][0]),f=d[0],g=d[1];a.env.isIE&&(f=d3.event.offsetX,g=d3.event.offsetY);var h,i,j;if("ordinal"==b.scale_type){var k=b.scale.range();for(j=b.scale.rangeBand(),i=0;g>k[i]+j;i++);h=b.scale.domain()[i]}else h=b.scale.invert(g);if(c.div.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+15+"px"),e!=h){e=h;var l=c.chart.dataset_manager.lookup("y",h,!0);for(i=0;i<l.length;i++)c.chart.series[l[i].series_num].highlight(l[i]);var m="";for(m+="<b>"+c.yFormat(l[0].y)+"</b>",i=0;i<l.length;i++)m+="<br/><span style='color:"+c.chart._color(l[i].series_num)+";'>&#8226;</span> ",m+=l[i].series_name+": "+c.xFormat(l[i].x);if(c.div.html(m),c.show_scan_line){(c.chart.dataset_manager.has_series_type("bar")||c.chart.dataset_manager.has_series_type("stackedbar"))&&(c.scan_line_width="ordinal"==b.scale_type?b.scale.rangeBand()*(1+b.band_padding):b.scale(b.min_step)-b.scale(0));var n=b.scale(l[0].y)-c.scan_line_width/2+("ordinal"==b.scale_type?j/2:0);c.chart.event_layer.svg.select(".ccd3_axis_scan_line").attr("y",n).attr("height",c.scan_line_width).attr("x",0).attr("width",c.chart.inner_width).attr("visibility","visible")}}})},a.Parts.Menu=function(){a.Parts.apply(this,arguments)},a.Parts.Menu.prototype=new a.Parts,a.Parts.Menu.prototype.get_defaults=function(){return{menus:[{key:"csv",label:"CSV Download",func:function(){this.dataset_manager.download_as_csv(this.dataset_manager.to_csv())}},{key:"reset",label:"Reset Chart",func:function(){for(var b=0,c=this.dataset.length;c>b;b++)this.dataset[b].visible=!0;"pie"===this.dataset[0].series_type&&(this.series[0].sort=void 0),this.zoomed=!1,this.zoom instanceof a.Parts&&this.zoom.remove_reset_button(),this.render()}},{key:"close",label:"Close Menu",func:function(){this.menu.toggle_menu()}}],opened:!1,font_size:10,icon_top:2,icon_height:15,icon_width:24,icon_right:5,item_x_margin:10,item_y_margin:5,item_interval:32,item_opacity:.8}},a.Parts.Menu.prototype.add_menu=function(a,b){if(b){a.key=b;for(var c=0;c<this.menus.length;c++)if(this.menus[c].key==b)return void(this.menus[c]=a);this.add_menu(a)}else this.menus.splice(this.menus.length-2,0,a)},a.Parts.Menu.prototype.render=function(){var a=this;void 0===this.svg&&(this.svg=this.chart.svg.append("g").attr("class","ccd3_menu"),this.svg_icon=this.svg.append("g").attr("class","ccd3_menu_icon"),this.svg_list=this.svg.append("g").attr("class","ccd3_menu_list"),this.svg_icon.append("rect").attr("class","ccd3_menu_rect").attr("width",this.icon_width).attr("height",this.icon_height).attr("fill","white").attr("opacity",0),this.svg_icon.append("rect").attr("class","ccd3_menu_bar").attr("y",1),this.svg_icon.append("rect").attr("class","ccd3_menu_bar").attr("y",6),this.svg_icon.append("rect").attr("class","ccd3_menu_bar").attr("y",11),this.svg_icon.selectAll(".ccd3_menu_bar").attr("width",20).attr("height",2).attr("rx",2).attr("ry",2).attr("x",2).attr("fill","gray"),this.svg_icon.on("click",function(){a.opened,a.toggle_menu()})),this.arrange(this.chart.width-this.icon_width-this.icon_right,this.icon_top)},a.Parts.Menu.prototype.toggle_menu=function(){var a=this,b=this.opened?[]:this.menus;this.opened=!this.opened;var c=function(b,c){var d=a.icon_width+20,e=a.icon_top+a.icon_height+a.font_size+c*a.item_interval+15;return"translate("+d+","+e+")"},d=function(b,c){var d=-1*this.getBBox().width+a.icon_width+a.item_x_margin+40,e=a.icon_top+a.icon_height+a.font_size+c*a.item_interval+15;return"translate("+d+","+e+")"},e=this.svg_list.selectAll(".ccd3_menu_item").data(b);e.enter().append("g").attr("class","ccd3_menu_item").attr("cursor","pointer").call(function(b){b.append("rect").attr("fill","white").attr("stroke","gray").attr("opacity",a.item_opacity).attr("rx",8).attr("ry",8)}).call(function(b){b.append("text").text(function(a){return a.label}).attr("font-size",a.font_size)}).on("mouseover",function(){d3.select(this).select("rect").attr("fill","lightyellow")}).on("mouseout",function(){d3.select(this).select("rect").attr("fill","white")}).on("click",function(){var b=d3.select(this).datum();b.func.call(a.chart,b)}).attr("transform",c),e.selectAll(".ccd3_menu_item rect").attr("x",function(){return-1*a.item_x_margin}).attr("y",function(){return this.nextSibling.getBBox().height/-2+-2*a.item_y_margin}).attr("width",function(){return this.nextSibling.getBBox().width+2*a.item_x_margin+30}).attr("height",function(){return this.nextSibling.getBBox().height+2*a.item_y_margin}),e.transition().duration(500).attr("transform",d),e.exit().transition().duration(500).attr("transform",c).remove()},a.Parts.OverlayLoading=function(){a.Parts.apply(this,arguments)},a.Parts.OverlayLoading.prototype=new a.Parts,a.Parts.OverlayLoading.prototype.get_defaults=function(){return{font_size:14}},a.Parts.OverlayLoading.prototype.render=function(a){var b=this;void 0!==this.chart.svg&&(void 0===this.svg&&(this.svg=this.chart.svg.append("g").attr("class","ccd3_overlay"),this.svg.append("rect").attr("class","ccd3_overlay_rect").attr("fill","white").attr("opacity",.6),this.svg.append("text").attr("class","ccd3_overlay_message").attr("font-size",this.font_size)),this.svg.select(".ccd3_overlay_rect").attr("width",b.chart.width).attr("height",b.chart.height),this.svg.select(".ccd3_overlay_message").text("Now Loading ...").attr("x",function(){return b.chart.width/2-this.getBBox().width/2}).attr("y",function(){return b.chart.height/2-this.getBBox().height/2}),a?this.svg.attr("visibility","visible"):this.svg.attr("visibility","hidden"))},a.Parts.Axis=function(){a.Parts.apply(this,arguments)},a.Parts.Axis.prototype=new a.Parts,a.Parts.Axis.prototype.get_defaults=function(){return{svg:null,axis:void 0,scale:void 0,scale_type:null,min_step:null,range_max:0,range_min:0,domain_max:void 0,domain_min:void 0,domain_margin:.1,domain_margin_type:void 0,band_padding:.2,format:void 0,show_label:!0,tick_num:void 0,tick_padding:5,tick_values:void 0,font_size:10,label_width:0,label_height:0,margin_top:3,margin_bottom:3,margin_right:3,margin_left:3}},a.Parts.Axis.prototype.render=function(){},a.Parts.Axis.prototype.init_format=function(){if(void 0===this.format)if("date"===this.scale_type)this.format=a.Util.default_date_format;else if("linear"===this.scale_type)this.format=a.Util.default_numeric_format;else{if("ordinal"!==this.scale_type)throw new Error("Invalid scale_type");this.format=function(a){return a}}},a.Parts.Axis.prototype.init_scale=function(){if(!this.scale)switch(this.scale_type){case"date":this.scale=d3.time.scale();break;case"linear":this.scale=d3.scale.linear();break;case"ordinal":this.scale=d3.scale.ordinal()}this.init_format()},a.Parts.Axis.prototype.reset_range=function(a){if(this.range_max=a,"ordinal"===this.scale_type)this.scale.rangeBands([this.range_min,this.range_max],this.band_padding),this.tick_values=void 0;else if("date"===this.scale_type){this.scale.range([this.range_min,this.range_max]);var b=this.scale.ticks(),c=[];b.length>=2&&this.format(b[0])!=this.format(b[1])&&c.push(b[0]);for(var d=b[0],e=1,f=b.length;f>e;e++)this.format(d)!=this.format(b[e])&&c.push(b[e]),d=b[e];this.tick_values=c}else this.scale.range([this.range_min,this.range_max]),this.tick_values=void 0},a.Parts.Axis.prototype.reset_domain=function(){var a,b,c,d=[],e=this.direction;if("ordinal"===this.scale_type){c=function(a){return a[e]};for(var f=0,g=this.chart.dataset.length;g>f;f++)this.chart.dataset[f].visible&&(d=d.concat(this.chart.dataset[f].values.map(c).sort()))}else"x"===e?c="date"===this.scale_type?function(a){return a.x}:function(a){return a.x+(void 0===a.x0?0:a.x0)}:"y"===e&&(c="date"===this.scale_type?function(a){return a.y}:function(a){return a.y+(void 0===a.y0?0:a.y0)}),a=this.chart.dataset_manager.get_min(c),b=this.chart.dataset_manager.get_max(c),void 0===a||void 0===b?(a=void 0,b=void 0):this.direction!==this.chart.direction&&"grid"!==this.domain_margin_type?(a>=0&&a-(b-a)*this.domain_margin<0?a=0:a-=(b-a)*this.domain_margin,0>=b&&b+(b-a)*this.domain_margin>0?b=0:b+=(b-a)*this.domain_margin):"date"===this.scale_type?(a=new Date(a.getTime()-this.min_step/2),b=new Date(b.getTime()+this.min_step/2)):"linear"===this.scale_type&&(a-=this.min_step/2,b+=this.min_step/2),void 0!==this.domain_min&&(a=this.domain_min),void 0!==this.domain_max&&(b=this.domain_max),d="x"===e||"y"===this.chart.direction?[a,b]:[b,a];this.scale.domain(d)},a.Parts.Axis.xAxis=function(){a.Parts.Axis.apply(this,arguments)},a.Parts.Axis.xAxis.prototype=new a.Parts.Axis,a.Parts.Axis.xAxis.prototype.get_defaults=function(){return{direction:"x"}},a.Parts.Axis.xAxis.prototype.render=function(){var b,c=this,d=(this.chart.inner_width,this.chart.inner_height);this.svg||(this.svg=this.chart.svg.append("g").attr("class","ccd3_xAxis")),b=this.show_label?this.format:function(){return""},this.axis=d3.svg.axis().scale(this.scale).tickSize(-1*d).orient("bottom").tickFormat(b),this.tick_values?this.axis.tickValues(this.tick_values):this.tick_num&&this.axis.ticks(this.tick_num),this.svg.call(this.axis).selectAll(".tick text").style("text-anchor","end").attr("class","ccd3_x_tick_label").attr("font-size",this.font_size).attr("transform",function(){return"translate("+this.getBBox().height*-.5+","+c.tick_padding+")rotate(-90)"}),this.svg.selectAll(".tick text").each(function(){var b=d3.select(this).text();d3.select(this).text(a.Util.extract_axis_text(b))}),this.text_height=d3.max(this.svg.selectAll(".ccd3_x_tick_label")[0].map(function(a){return a.getBBox().width})),this.label_height=this.text_height+this.margin_top+this.margin_bottom},a.Parts.Axis.yAxis=function(){a.Parts.Axis.apply(this,arguments)},a.Parts.Axis.yAxis.prototype=new a.Parts.Axis,a.Parts.Axis.yAxis.prototype.get_defaults=function(){return{direction:"y"}},a.Parts.Axis.yAxis.prototype.render=function(){{var b,c=this.chart.inner_width;this.chart.inner_height}this.svg||(this.svg=this.chart.svg.append("g").attr("class","ccd3_yAxis")),b=this.show_label?this.format:function(){return""},this.axis=d3.svg.axis().scale(this.scale).tickSize(-1*c).tickPadding(this.tick_padding).orient("left").tickFormat(b),this.tick_values?this.axis.tickValues(this.tick_values):this.tick_num&&this.axis.ticks(this.tick_num),this.svg.call(this.axis).selectAll(".tick text").attr("class","ccd3_y_tick_label").attr("font-size",this.font_size),this.svg.selectAll(".tick text").each(function(){var b=d3.select(this).text();d3.select(this).text(a.Util.extract_axis_text(b))}),this.text_width=d3.max(this.svg.selectAll(".ccd3_y_tick_label")[0].map(function(a){return a.getBBox().width})),this.label_width=this.text_width+this.margin_right+this.margin_left},a.Parts.rAxis=function(){a.Parts.apply(this,arguments)},a.Parts.rAxis.prototype=new a.Parts,a.Parts.rAxis.prototype.get_defaults=function(){return{radius:void 0,scale:void 0,format:void 0,font_size:10}},a.Parts.rAxis.prototype.render=function(){var a=this;this.init_scale(),this.svg||(this.svg=this.chart.svg.append("g").attr("class","ccd3_rAxis"));var b=this.svg.selectAll(".ccd3_rAxis_ticks").data(a.scale.ticks(3));b.enter().append("g").attr("class","ccd3_rAxis_ticks").call(function(a){a.append("circle").attr("fill","none").attr("stroke","lightgray").attr("stroke-width",1)}).call(function(b){b.append("text").attr("text-anchor","middle").attr("font-size",a.font_size)}),b.call(function(b){b.select("circle").attr("r",function(b){return a.scale(b)})}).call(function(b){b.select("text").text(function(b){return a.format(b)}).attr("y",function(b){return-1*a.scale(b)})}),b.exit().remove()},a.Parts.rAxis.prototype.init_format=function(){void 0===this.format&&(this.format=a.Util.default_numeric_format)},a.Parts.rAxis.prototype.init_scale=function(){this.scale||(this.scale=d3.scale.linear()),this.init_format()},a.Parts.rAxis.prototype.reset_range=function(a){this.radius=a,this.scale.range([0,.8*this.radius])},a.Parts.rAxis.prototype.reset_domain=function(){var a=function(a){return a.y},b=this.chart.dataset_manager.get_max(a);this.scale.domain([0,b])},a.Parts.aAxis=function(){a.Parts.apply(this,arguments)},a.Parts.aAxis.prototype=new a.Parts,a.Parts.aAxis.prototype.get_defaults=function(){return{radius:void 0,scale:void 0,format:void 0,font_size:10}},a.Parts.aAxis.prototype.render=function(){var a=this;this.init_scale(),this.svg||(this.svg=this.chart.svg.append("g").attr("class","ccd3_aAxis"));var b=this.svg.selectAll(".ccd3_aAxis_ticks").data(this.scale.domain());b.enter().append("g").attr("class","ccd3_aAxis_ticks").call(function(a){a.append("line").attr("x1",0).attr("y1",0).attr("stroke","lightgray").attr("stroke-width",1)}).call(function(b){b.append("text").attr("text-anchor","middle").attr("font-size",a.font_size)}),b.call(function(b){b.select("line").attr("x2",function(b){return a.radius*Math.sin(a.scale(b))}).attr("y2",function(b){return a.radius*Math.cos(a.scale(b))*-1})}).call(function(b){b.select("text").text(function(b){return a.format(b)}).attr("transform",function(b){var c=(a.radius-a.font_size)*Math.sin(a.scale(b)),d=(a.radius-a.font_size)*Math.cos(a.scale(b))*-1,e=this.getBBox().width;
return c+e/2>a.chart.inner_width/2?c=a.chart.inner_width/2-e/2:c-e/2<a.chart.inner_width/2*-1&&(c=a.chart.inner_width/2*-1+e/2),"translate("+c+","+d+")"})}),b.exit().remove()},a.Parts.aAxis.prototype.init_format=function(){void 0===this.format&&(this.format=function(a){return a})},a.Parts.aAxis.prototype.init_scale=function(){this.scale||(this.scale=d3.scale.ordinal().rangePoints([0,2*Math.PI],1)),this.init_format()},a.Parts.aAxis.prototype.reset_range=function(a){this.radius=a},a.Parts.aAxis.prototype.reset_domain=function(){for(var a=[],b=function(a){return a.x},c=0,d=this.chart.dataset.length;d>c;c++)this.chart.dataset[c].visible&&(a=a.concat(this.chart.dataset[c].values.map(b)));this.scale.domain(a)},a.Parts.EventLayer=function(){a.Parts.apply(this,arguments)},a.Parts.EventLayer.prototype=new a.Parts,a.Parts.EventLayer.prototype.get_defaults=function(){return{}},a.Parts.EventLayer.prototype.render=function(){void 0===this.svg&&(this.svg=this.chart.series_container.svg.append("g").attr("class","ccd3_event_layer"),this.svg.append("rect").attr("class","background").attr("opacity",0).attr("x",0).attr("y",0)),this.svg.select("rect.background").attr("width",this.chart.inner_width).attr("height",this.chart.inner_height)},a.Parts.Zoom=function(){a.Parts.apply(this,arguments),this.render()},a.Parts.Zoom.prototype=new a.Parts,a.Parts.Zoom.prototype.get_defaults=function(){return{use:!0,font_size:12,margin_left:null,margin_top:null,button_svg:null}},a.Parts.Zoom.prototype.render=function(){if(void 0===this.svg){var a=this;this.brush=d3.svg.brush().x(this.chart.xAxis.scale).y(this.chart.yAxis.scale).on("brushend",function(){a.zoom()}),this.svg=this.chart.event_layer.svg.append("g").attr("class","ccd3_zoom").attr("cursor","crosshair").attr("fill","gray").attr("opacity",.3).call(this.brush)}},a.Parts.Zoom.prototype.zoom=function(){if(!this.brush.empty()){var a=this,b=this.chart,c=this.brush.extent();b.zoomed=!0,b.xAxis.scale.domain([c[0][0],c[1][0]]),b.yAxis.scale.domain("y"===b.direction?[c[0][1],c[1][1]]:[c[1][1],c[0][1]]),b.render({dont_reset_domain:!0}),this.brush.clear(),b.svg.selectAll(".ccd3_event_layer").call(this.brush),this.button_svg=b.series_container.svg.append("g").attr("class","ccd3_zoom_reset_button").attr("cursor","pointer").call(function(b){b.append("rect").attr("height","1.6em").attr("font-size",a.font_size).attr("fill","lightgray").attr("opacity",.7).attr("stroke","none").attr("rx",5).attr("ry",5).attr("x",-5)}).call(function(b){b.append("text").text("clear zoom").attr("fill","#333333").attr("text-anchor","left").attr("font-size",a.font_size).attr("y","1.2em")}).on("click",function(){a.reset_zoom()}),this.button_svg.call(function(a){a.select("rect").attr("width",function(){return this.nextSibling.getBBox().width+10})}),this.rearrange_reset_button()}},a.Parts.Zoom.prototype.reset_zoom=function(){var a=this.chart;a.zoomed=!1,a.render(),a.zoom.remove_reset_button()},a.Parts.Zoom.prototype.remove_reset_button=function(){this.button_svg&&(this.button_svg.remove(),this.button_svg=null)},a.Parts.Zoom.prototype.rearrange_reset_button=function(){if(this.button_svg){var a=this;this.button_svg.attr("transform",function(){return"translate("+(a.chart.inner_width-this.getBBox().width-10)+",5)"})}},a.Parts.Series=function(){a.Parts.apply(this,arguments)},a.Parts.Series.type_info=function(){return{heatmap:{obj:a.Parts.Series.Heatmap,zindex:1,is_single_series:!0},bar:{obj:a.Parts.Series.Bar,zindex:2},stackedbar:{obj:a.Parts.Series.StackedBar,zindex:3},bubble:{obj:a.Parts.Series.Bubble,zindex:4},line:{obj:a.Parts.Series.Line,zindex:5},scatter:{obj:a.Parts.Series.Scatter,zindex:6},pie:{obj:a.Parts.Series.Pie,zindex:0,is_single_series:!0},radar:{obj:a.Parts.Series.Radar,zindex:0}}},a.Parts.Series.prototype=new a.Parts,a.Parts.Series.prototype.get_defaults=function(){return{class_name:"ccd3_series",series:void 0,data:void 0,show_values:!1,color:null,font_size:10}},a.Parts.Series.prototype.render=function(){},a.Parts.Series.prototype.init_svg=function(b){if(this.series=b,!this.svg){var c=a.Parts.Series.type_info();this.svg=this.chart.series_container.svg.append("g").attr("id","series_"+b.series_num).attr("class","series").attr("series_num",b.series_num).attr("series_name",b.name).attr("class",this.class_name).attr("series_type",b.series_type).datum(1e3*c[b.series_type].zindex+b.series_num)}},a.Parts.Series.prototype.destroy=function(){this.svg.remove()},a.Parts.Series.prototype.exit=function(a){a.exit().transition().duration(500).ease("linear").style("opacity",0).remove()},a.Parts.Series.prototype.get_data=function(){return this.series.visible?this.series.values:[]},a.Parts.Series.prototype.text_visibility=function(){return this.show_values||"always"===this.chart.show_values||this.chart.zoomed&&"onzoom"===this.chart.show_values?!0:!1},a.Parts.Series.prototype.highlight_series=function(){},a.Parts.Series.prototype.highlight=function(){},a.Parts.Series.prototype.tooltip_html=function(a){var b="";return b+="<b><span style='color:"+this.color+";'>&#8226;</span> "+this.series.name+"</b>",b+="<br>x: "+this.chart.tooltip.xFormat(a.x),b+="<br>y: "+this.chart.tooltip.yFormat(a.y)},a.Parts.Series.Scatter=function(){a.Parts.Series.apply(this,arguments)},a.Parts.Series.Scatter.prototype=new a.Parts.Series,a.Parts.Series.Scatter.prototype.get_defaults=function(){return{point_radius:3,point_radius_highlight:5}},a.Parts.Series.Scatter.prototype.render=function(){var a=this,b=this.series.series_num,c=this.text_visibility(),d=this.chart.xAxis.scale,e=this.chart.yAxis.scale,f=this.chart.xAxis,g=this.chart.yAxis,h=this.chart.yAxis.format;this.color=this.chart._color(b);var i=this.svg.selectAll(".ccd3_circle_g").data(a.get_data());i.enter().append("g").attr("class","ccd3_circle_g").style("opacity",0).call(function(b){b.append("circle").attr("fill",a.color).attr("r",a.point_radius)}).call(function(a){a.append("text").attr("text-anchor","middle").attr("y","-0.5em").text(function(a){return h(a.y)})}).on("mouseover",function(){d3.select(this).select("circle").attr("r",a.point_radius_highlight)}).on("mouseout",function(){d3.select(this).select("circle").attr("r",a.point_radius)}).call(a.chart.tooltip.add_listener,a.chart.tooltip).call(function(b){a.onclick_customize_func&&b.on("click.customize_func",a.onclick_customize_func)}),i.transition().duration(500).attr("transform",function(a){var b,c;return b="ordinal"===f.scale_type?d(a.x)+d.rangeBand()/2:d(a.x),c="ordinal"===g.scale_type?e(a.y)+e.rangeBand()/2:e(a.y),"translate("+b+","+c+")"}).style("opacity",1).call(function(b){b.select("text").style("display",function(){return c?null:"none"}).attr("font-size",a.font_size)}),i.call(this.exit)},a.Parts.Series.Scatter.prototype.highlight_series=function(a){a?this.svg.selectAll(".ccd3_circle_g circle").attr("r",this.point_radius_highlight):this.svg.selectAll(".ccd3_circle_g circle").attr("r",this.point_radius)},a.Parts.Series.Scatter.prototype.highlight=function(a){var b=this;this.svg.selectAll(".ccd3_circle_g circle").attr("r",function(c){return""+c.x==""+a.x&&""+c.y==""+a.y?b.point_radius_highlight:b.point_radius})},a.Parts.Series.Bar=function(){a.Parts.Series.apply(this,arguments)},a.Parts.Series.Bar.prototype=new a.Parts.Series,a.Parts.Series.Bar.prototype.get_defaults=function(){return{opacity:.7}},a.Parts.Series.Bar.prototype.render=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o=this,p=this.series.series_num,q=this.text_visibility();this.color=this.chart._color(p),"x"===this.chart.direction?(c=this.chart.xAxis.scale,d=this.chart.yAxis.scale,g=this.chart.xAxis,f=this.chart.yAxis,e=this.chart.yAxis.format,n=this.chart.xAxis.band_padding):(c=this.chart.yAxis.scale,d=this.chart.xAxis.scale,g=this.chart.yAxis,f=this.chart.xAxis,e=this.chart.xAxis.format,n=this.chart.yAxis.band_padding),h="ordinal"===g.scale_type?c.rangeBand():Math.abs(c(g.min_step)-c(0));var r=h*(1-n)/a;"x"===this.chart.direction?(l=function(a){return a.y},j=function(){return r},k=function(a){return Math.abs(d(0)-d(a.y))},i=function(a){var e=c(a.x)+r*b+h*n/2;"ordinal"!==g.scale_type&&(e-=h/2);var f=Math.min(d(0),d(a.y));return"translate("+e+","+f+")"},m=function(){var a=r/2-this.getBBox().height/2,b=this.getBBox().height/2;return"translate("+a+","+b+") rotate(90)"}):(l=function(a){return a.x},j=function(a){return Math.abs(d(0)-d(a.x))},k=function(){return r},i=function(a){var e=c(a.y)+r*b+h*n/2;"ordinal"!==g.scale_type&&(e-=h/2);var f=Math.min(d(0),d(a.x));return"translate("+f+","+e+")"},m=function(a){var b=r/2+this.getBBox().height/2,c=d(a.x)-this.getBBox().width;return"translate("+c+","+b+")"});var s=this.svg.selectAll(".ccd3_bar_g").data(o.get_data());s.enter().append("g").attr("class","ccd3_bar_g").style("opacity",0).call(function(a){a.append("rect").attr("fill",o.color)}).call(function(a){a.append("text").text(function(a){return e(l(a))})}).on("mouseover",function(){d3.select(this).style("opacity",1)}).on("mouseout",function(){d3.select(this).style("opacity",o.opacity)}).call(o.chart.tooltip.add_listener,o.chart.tooltip).call(function(a){o.onclick_customize_func&&a.on("click.customize_func",o.onclick_customize_func)}),s.transition().duration(500).attr("transform",i).style("opacity",o.opacity).call(function(a){a.select("rect").attr("width",j).attr("height",k)}).call(function(a){a.select("text").attr("visibility",function(){return q?"visible":"hidden"}).attr("transform",m).attr("font-size",o.font_size)}),s.call(this.exit)},a.Parts.Series.Bar.prototype.highlight_series=function(a){a?this.svg.selectAll(".ccd3_bar_g").style("opacity",1):this.svg.selectAll(".ccd3_bar_g").style("opacity",this.opacity)},a.Parts.Series.Bar.prototype.highlight=function(a){var b=this;this.svg.selectAll(".ccd3_bar_g").style("opacity",function(c){return""+c.x==""+a.x&&""+c.y==""+a.y?1:b.opacity})},a.Parts.Series.StackedBar=function(){a.Parts.Series.apply(this,arguments)},a.Parts.Series.StackedBar.prototype=new a.Parts.Series,a.Parts.Series.StackedBar.prototype.get_defaults=function(){return{opacity:.7}},a.Parts.Series.StackedBar.prototype.render=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m=this,n=this.series.series_num,o=this.text_visibility();this.color=this.chart._color(n),"x"===this.chart.direction?(a=this.chart.xAxis.scale,b=this.chart.yAxis.scale,e=this.chart.xAxis,d=this.chart.yAxis,c=this.chart.yAxis.format,l=this.chart.xAxis.band_padding):(a=this.chart.yAxis.scale,b=this.chart.xAxis.scale,e=this.chart.yAxis,d=this.chart.xAxis,c=this.chart.xAxis.format,l=this.chart.yAxis.band_padding),f="ordinal"===e.scale_type?a.rangeBand():Math.abs(a(e.min_step)-a(0));var p=f*(1-l);"x"===this.chart.direction?(j=function(a){return a.y},h=function(){return p},i=function(a){return Math.abs(b(a.y0)-b(a.y+a.y0))},g=function(c){var d=a(c.x)+f*l/2;"ordinal"!==e.scale_type&&(d-=f/2);var g=Math.min(b(c.y0),b(c.y+c.y0));return"translate("+d+","+g+")"},k=function(){var a=p/2-this.getBBox().height/2,b=this.getBBox().height/2;return"translate("+a+","+b+") rotate(90)"}):(j=function(a){return a.x},h=function(a){return Math.abs(b(a.x0)-b(a.x+a.x0))},i=function(){return p},g=function(c){var d=a(c.y)+f*l/2;"ordinal"!==e.scale_type&&(d-=f/2);var g=Math.min(b(c.x0),b(c.x+c.x0));return"translate("+g+","+d+")"},k=function(a){var c=p/2+this.getBBox().height/2,d=b(a.x+a.x0)-b(a.x0)-this.getBBox().width-5;return"translate("+d+","+c+")"});var q=this.svg.selectAll(".ccd3_bar_g").data(m.get_data());q.enter().append("g").attr("class","ccd3_bar_g").style("opacity",0).call(function(a){a.append("rect").attr("fill",m.color)}).call(function(a){a.append("text").text(function(a){return c(j(a))}).attr("transform","rotate(90)")}).on("mouseover",function(){d3.select(this).style("opacity",1)}).on("mouseout",function(){d3.select(this).style("opacity",m.opacity)}).call(m.chart.tooltip.add_listener,m.chart.tooltip).call(function(a){m.onclick_customize_func&&a.on("click.customize_func",m.onclick_customize_func)}),q.transition().duration(500).attr("transform",g).style("opacity",m.opacity).call(function(a){a.select("rect").attr("width",h).attr("height",i)}).call(function(a){a.select("text").attr("visibility",function(){return o?"visible":"hidden"}).attr("transform",k).attr("font-size",m.font_size)}),q.call(this.exit)},a.Parts.Series.StackedBar.prototype.highlight_series=function(a){a?this.svg.selectAll(".ccd3_bar_g").style("opacity",1):this.svg.selectAll(".ccd3_bar_g").style("opacity",this.opacity)},a.Parts.Series.StackedBar.prototype.highlight=function(a){var b=this;this.svg.selectAll(".ccd3_bar_g").style("opacity",function(c){return""+c.x==""+a.x&&""+c.y==""+a.y?1:b.opacity})},a.Parts.Series.Line=function(){a.Parts.Series.apply(this,arguments)},a.Parts.Series.Line.prototype=new a.Parts.Series,a.Parts.Series.Line.prototype.get_defaults=function(){return{opacity:.7,line_width:1,line_width_highlight:3,point_radius:3,point_radius_highlight:5}},a.Parts.Series.Line.prototype.render=function(){var a=this,b=this.series.series_num,c=this.text_visibility(),d=this.chart.xAxis.scale,e=this.chart.yAxis.scale,f=this.chart.xAxis,g=this.chart.yAxis,h=this.chart.yAxis.format;this.color=this.chart._color(b);var i=function(a){return"ordinal"===f.scale_type?d(a.x)+d.rangeBand()/2:d(a.x)},j=function(a){return"ordinal"===g.scale_type?e(a.y)+e.rangeBand()/2:e(a.y)},k=this.series.visible?[0]:[],l=d3.svg.line().x(i).y(j).interpolate("linear"),m=this.svg.selectAll("path").data(k);m.enter().append("path").attr("class","series_path").attr("stroke",a.color).attr("stroke-width",a.line_width).attr("fill","none").style("opacity",0),m.transition().duration(500).attr("d",l(a.get_data())).style("opacity",a.opacity),m.call(this.exit);var n=this.svg.selectAll(".ccd3_circle_g").data(a.get_data());n.enter().append("g").attr("class","ccd3_circle_g").style("opacity",0).call(function(b){b.append("circle").attr("fill",a.color).attr("r",a.point_radius)}).call(function(a){a.append("text").attr("text-anchor","middle").attr("y","-0.5em").text(function(a){return h(a.y)})}).on("mouseover",function(){d3.select(this).select("circle").attr("r",a.point_radius_highlight),d3.select(this.parentNode).select(".series_path").attr("stroke-width",a.line_width_highlight)}).on("mouseout",function(){d3.select(this).select("circle").attr("r",a.point_radius),d3.select(this.parentNode).select(".series_path").attr("stroke-width",a.line_width)}).call(a.chart.tooltip.add_listener,a.chart.tooltip).call(function(b){a.onclick_customize_func&&b.on("click.customize_func",a.onclick_customize_func)}),n.transition().duration(500).attr("transform",function(a){return"translate("+i(a)+","+j(a)+")"}).style("opacity",1).call(function(b){b.select("text").style("display",function(){return c?null:"none"}).attr("font-size",a.font_size)}),n.call(this.exit)},a.Parts.Series.Line.prototype.highlight_series=function(a){a?(this.svg.selectAll(".ccd3_circle_g circle").attr("r",this.point_radius_highlight),this.svg.selectAll(".series_path").attr("stroke-width",this.line_width_highlight)):(this.svg.selectAll(".ccd3_circle_g circle").attr("r",this.point_radius),this.svg.selectAll(".series_path").attr("stroke-width",this.line_width))},a.Parts.Series.Line.prototype.highlight=function(a){var b=this;this.svg.selectAll(".ccd3_circle_g circle").attr("r",function(c){return""+c.x==""+a.x&&""+c.y==""+a.y?b.point_radius_highlight:b.point_radius})},a.Parts.Series.Bubble=function(){a.Parts.Series.apply(this,arguments)},a.Parts.Series.Bubble.prototype=new a.Parts.Series,a.Parts.Series.Bubble.prototype.get_defaults=function(){return{opacity:.7,max_radius:10,min_radius:3,zFormat:a.Util.default_numeric_format}},a.Parts.Series.Bubble.prototype.render=function(){var a=this,b=this.series.series_num,c=this.text_visibility(),d=this.chart.xAxis.scale,e=this.chart.yAxis.scale,f=this.chart.xAxis,g=this.chart.yAxis;if(this.color=this.chart._color(b),void 0===this.zScale){var h=this.chart.dataset_manager.get_max(function(a){return a.z}),i=this.chart.dataset_manager.get_min(function(a){return a.z});this.zScale=d3.scale.linear().range([this.min_radius,this.max_radius]).domain([i,h])}var j=this.zScale;this.chart.tooltip.zFormat||(this.chart.tooltip.zFormat=this.zFormat);var k=this.svg.selectAll(".ccd3_bubble_g").data(a.get_data());k.enter().append("g").attr("class","ccd3_bubble_g").style("opacity",0).call(function(b){b.append("circle").attr("fill",a.color).attr("r",0)}).call(function(b){b.append("text").attr("text-anchor","middle").attr("y","0.4em").text(function(b){return a.zFormat(b.z)})}).on("mouseover",function(){d3.select(this).style("opacity",1)}).on("mouseout",function(){d3.select(this).style("opacity",a.opacity)}).call(a.chart.tooltip.add_listener,a.chart.tooltip).call(function(b){a.onclick_customize_func&&b.on("click.customize_func",a.onclick_customize_func)}),k.transition().duration(500).attr("transform",function(a){var b,c;return b="ordinal"===f.scale_type?d(a.x)+d.rangeBand()/2:d(a.x),c="ordinal"===g.scale_type?e(a.y)+e.rangeBand()/2:e(a.y),"translate("+b+","+c+")"}).style("opacity",a.opacity).call(function(a){a.select("circle").attr("r",function(a){return j(a.z)})}).call(function(b){b.select("text").attr("visibility",function(){return c?"visible":"hidden"}).attr("font-size",a.font_size)}),k.call(this.exit)},a.Parts.Series.Bubble.prototype.highlight_series=function(a){a?this.svg.selectAll(".ccd3_bubble_g").style("opacity",1):this.svg.selectAll(".ccd3_bubble_g").style("opacity",this.opacity)},a.Parts.Series.Bubble.prototype.highlight=function(a){var b=this;this.svg.selectAll(".ccd3_bubble_g").style("opacity",function(c){return""+c.x==""+a.x&&""+c.y==""+a.y?1:b.opacity})},a.Parts.Series.Bubble.prototype.tooltip_html=function(a){var b="";return b+="<b><span style='color:"+this.color+";'>&#8226;</span> "+this.series.name+"</b>",b+="<br>x: "+this.chart.tooltip.xFormat(a.x),b+="<br>y: "+this.chart.tooltip.yFormat(a.y),b+="<br>z: "+this.chart.tooltip.zFormat(a.z)},a.Parts.Series.Heatmap=function(){a.Parts.Series.apply(this,arguments)},a.Parts.Series.Heatmap.prototype=new a.Parts.Series,a.Parts.Series.Heatmap.prototype.get_defaults=function(){return{low_color:"red",high_color:"green",zFormat:a.Util.default_numeric_format,onclick_customize_func:null}},a.Parts.Series.Heatmap.prototype.render=function(){var a,b,c=this,d=this.series.series_num,e=this.text_visibility(),f=this.chart.xAxis.scale,g=this.chart.yAxis.scale,h=this.chart.xAxis,i=this.chart.yAxis;this.color=this.chart._color(d);var j,k;this.chart.tooltip.zFormat||(this.chart.tooltip.zFormat=this.zFormat),a="ordinal"===h.scale_type?f.rangeBand():Math.abs(f(h.min_step)-f(0)),b="ordinal"===i.scale_type?g.rangeBand():Math.abs(g(i.min_step)-g(0)),a+=1,b+=1;var l=this.chart.dataset_manager.get_max(function(a){return a.z}),m=this.chart.dataset_manager.get_min(function(a){return a.z});this.cScale=d3.scale.linear().range([this.low_color,this.high_color]).domain([m,l]).interpolate(d3.interpolateHsl);this.cScale;j=function(c){var d=f(c.x);"ordinal"!==h.scale_type&&(d-=a/2);var e=g(c.y);return"ordinal"!==i.scale_type&&(e-=b/2),"translate("+d+","+e+")"},k=function(){var c=a/2,d=b/2+this.getBBox().height/2;return"translate("+c+","+d+")"};var n=this.svg.selectAll(".ccd3_rect_g").data(c.get_data());n.enter().append("g").attr("class","ccd3_rect_g").style("opacity",0).call(function(a){a.append("rect")}).call(function(a){a.append("text").attr("font-size",c.font_size).attr("text-anchor","middle")}).call(c.chart.tooltip.add_listener,c.chart.tooltip).call(function(a){c.onclick_customize_func&&a.on("click.customize_func",c.onclick_customize_func)}),n.transition().duration(500).style("opacity",c.opacity).attr("transform",j).call(function(d){d.select("rect").attr("width",a).attr("height",b).attr("fill",function(a){return c.cScale(a.z)})}).call(function(a){a.select("text").attr("visibility",function(){return e?"visible":"hidden"}).attr("transform",k).text(function(a){return c.zFormat(a.z)})}),n.call(this.exit)},a.Parts.Series.Heatmap.prototype.tooltip_html=function(b){var c="";return c+="x: "+this.chart.tooltip.xFormat(a.Util.extract_axis_text(b.x)),c+="<br>y: "+this.chart.tooltip.yFormat(a.Util.extract_axis_text(b.y)),c+="<br>z: "+this.chart.tooltip.zFormat(b.z)},a.Parts.Series.Pie=function(){a.Parts.Series.apply(this,arguments)},a.Parts.Series.Pie.prototype=new a.Parts.Series,a.Parts.Series.Pie.prototype.get_defaults=function(){return{inner_radius:0,radius_nofocus:.95,opacity:.7,yFormat:a.Util.default_numeric_format,sort:void 0,pFormat:a.Util.default_percent_format}},a.Parts.Series.Pie.prototype.render=function(){var a=this;this.chart.tooltip.yFormat||(this.chart.tooltip.yFormat=this.yFormat),this.radius=Math.min(this.chart.inner_height,this.chart.inner_width)/2;var b=d3.svg.arc().outerRadius(this.radius*this.radius_nofocus).innerRadius(this.radius*this.inner_radius),c=d3.layout.pie().value(function(a){return a.y});c.sort("desc"==this.sort?function(a,b){return b.y-a.y}:"asc"===this.sort?function(a,b){return a.y-b.y}:null),this.svg.attr("transform",function(){return"translate("+a.chart.inner_width/2+","+a.chart.inner_height/2+")"});var d=c(this.get_data()),e=this.svg.selectAll(".ccd3_arc_g").data(d);e.enter().append("g").attr("class","ccd3_arc_g").style("opacity",this.opacity).call(a.chart.tooltip.add_listener,a.chart.tooltip).call(function(b){a.onclick_customize_func&&b.on("click.customize_func",a.onclick_customize_func)}).on("mouseover",function(){d3.select(this).style("opacity",1).select("path").attr("d",function(c){return b.outerRadius(a.radius),b(c)})}).on("mouseout",function(){d3.select(this).style("opacity",a.opacity).select("path").attr("d",function(c){return b.outerRadius(a.radius*a.radius_nofocus),b(c)})}).call(function(b){b.append("path").style("fill",function(b,c){return a.chart._color(c)})}).call(function(c){c.append("text").attr("dy",".35em").style("text-anchor","middle").attr("transform",function(a){return"translate("+b.centroid(a)+")"}).call(function(a){a.append("tspan").attr("class","label_x").attr("y","-1em").text(function(a){return a.data.x})}).call(function(b){b.append("tspan").attr("class","label_p").attr("dy","1em").attr("x",0).text(function(b){return a.pFormat(a.calc_percent(b))})}).call(function(b){b.append("tspan").attr("class","label_y").attr("dy","1em").attr("x",0).text(function(b){return a.yFormat(b.data.y)})})}),e.transition().duration(500).call(function(a){a.select("path").attr("d",b)}).call(function(c){c.select("text").attr("transform",function(a){return"translate("+b.centroid(a)+")"}).call(function(a){a.select("tspan.label_x").text(function(a){return a.data.x})}).call(function(b){b.select("tspan.label_p").text(function(b){return a.pFormat(a.calc_percent(b))})}).call(function(b){b.select("tspan.label_y").text(function(b){return a.yFormat(b.data.y)})}).style("visibility",function(b){var c=this.getBBox().width,d=this.getBBox().height,e=Math.abs(Math.cos(b.startAngle)-Math.cos(b.endAngle))*a.radius/2,f=Math.abs(Math.sin(b.startAngle)-Math.sin(b.endAngle))*a.radius/2;return e>=c||f>=d?"visible":"hidden"})}),e.call(this.exit)},a.Parts.Series.Pie.prototype.calc_percent=function(a){return(a.endAngle-a.startAngle)/(2*Math.PI)},a.Parts.Series.Pie.prototype.tooltip_html=function(a){var b="";return b+="<b>"+a.data.x+"</b>",b+="<br>%: "+this.pFormat(this.calc_percent(a)),b+="<br>value: "+this.chart.tooltip.yFormat(a.data.y)},a.Parts.Series.Radar=function(){a.Parts.Series.apply(this,arguments)},a.Parts.Series.Radar.prototype=new a.Parts.Series,a.Parts.Series.Radar.prototype.get_defaults=function(){return{point_radius:5,point_radius_highlight:8}},a.Parts.Series.Radar.prototype.render=function(){var a=this,b=this.get_data(),c=this.chart.rAxis.scale,d=this.chart.aAxis.scale,e=this.series.series_num;this.color=this.chart._color(e);var f=function(a){return[Math.sin(d(a.x))*c(a.y),Math.cos(d(a.x))*c(a.y)*-1]};this.svg.attr("transform",function(){return"translate("+a.chart.inner_width/2+","+a.chart.inner_height/2+")"});var g=this.series.visible?[0]:[],h=this.svg.selectAll(".ccd3_poly").data(g);h.enter().append("polygon").attr("class","ccd3_poly").attr("stroke",a.color).attr("stroke-width",2).attr("fill",a.color).attr("fill-opacity",.1).on("mouseover",function(){d3.select(this).style("fill-opacity",.5)}).on("mouseout",function(){d3.select(this).style("fill-opacity",.1)}),h.transition().duration(500).attr("points",function(){for(var a,c="",d=0,e=b.length;e>d;d++)a=f(b[d]),c+=a[0]+","+a[1]+" ";return c}),h.call(this.exit);var i=this.svg.selectAll(".ccd3_points_g").data(b);i.enter().append("g").call(a.chart.tooltip.add_listener,a.chart.tooltip).call(function(b){a.onclick_customize_func&&b.on("click.customize_func",a.onclick_customize_func)}).attr("class","ccd3_points_g").call(function(b){b.append("circle").attr("fill",a.color).attr("r",a.point_radius)}).on("mouseover",function(){d3.select(this).select("circle").attr("r",a.point_radius_highlight)}).on("mouseout",function(){d3.select(this).select("circle").attr("r",a.point_radius)}),i.transition().duration(500).attr("transform",function(a){var b=f(a);return"translate("+b[0]+","+b[1]+")"}),i.call(this.exit)},a.Parts.Series.Radar.prototype.highlight_series=function(a){a?this.svg.selectAll(".ccd3_poly").style("fill-opacity",.5):this.svg.selectAll(".ccd3_poly").style("fill-opacity",.1)},a.Parts.Series.Radar.prototype.tooltip_html=function(a){var b="";return b+="<b><span style='color:"+this.color+";'>&#8226;</span> "+this.series.name+"</b>",b+="<br>x: "+this.chart.tooltip.xFormat(a.x),b+="<br>y: "+this.chart.tooltip.yFormat(a.y)},a.DatasetManager=function(b,c){this.chart=b,this.csv_auto_format=!1,a.Util.merge(this,c)},a.DatasetManager.prototype.setup=function(b){var c,d,e=a.Parts.Series.type_info();for(this.dataset=a.Util.copy(b),this.dataset_original=a.Util.copy(b),b=this.dataset,c=0,d=b.length;d>c;c++)b[c].series_num=c,void 0===b[c].series_type&&(b[c].series_type=this.chart.default_series_type),void 0===b[c].name&&(b[c].name="series"+(c+1)),void 0===b[c].visible&&(b[c].visible=!0),void 0!==b[c].color&&(this.chart.color_palette[c]=b[c].color);var f=[];for(c=0,d=b.length;d>c;c++){if(void 0!==b[c].series_type&&!e.hasOwnProperty(b[c].series_type))throw new Error("invalid series_type");f.push(b[c].series_type)}for(var g in e)if(e.hasOwnProperty(g)&&e[g].is_single_series&&f.indexOf(g)>=0&&f.length>1)throw new Error("If you use '"+g+"' series_type, you must set only one series in dataset.");if(f.indexOf("bar")>=0&&f.indexOf("stackedbar")>=0)throw new Error("You can't use 'bar' and 'stackedbar' series_type at the same time.");return b},a.DatasetManager.prototype.detect_chart_pattern=function(){return"pie"===this.dataset[0].series_type?"r":"radar"===this.dataset[0].series_type?"ra":"xy"},a.DatasetManager.prototype.options_from_dataset=function(){var a={};return"heatmap"===this.dataset[0].series_type&&(a={legend:{show:!1},xAxis:{band_padding:0,domain_margin_type:"grid"},yAxis:{band_padding:0,domain_margin_type:"grid"}}),a},a.DatasetManager.prototype.has_directive_series_type=function(){for(var a=["bar","stackedbar","line"],b=0,c=this.dataset.length;c>b;b++)if(a.indexOf(this.dataset[b].series_type)>=0)return!0;return!1},a.DatasetManager.prototype.has_series_type=function(a){for(var b=0,c=this.dataset.length;c>b;b++)if(this.dataset[b].series_type==a)return!0;return!1},a.DatasetManager.prototype.has_single_series_type=function(a){for(var b=0,c=this.dataset.length;c>b;b++)if(this.dataset[b].series_type!=a)return!1;return!0},a.DatasetManager.prototype.detect_scale_type=function(a){var b=a.call(this,this.dataset[0].values[0]);return b instanceof Date?"date":"number"==typeof b?"linear":"string"==typeof b?"ordinal":null},a.DatasetManager.prototype.calc_min_step=function(a){for(var b,c,d=this.dataset,e=function(a,b){return b-a},f=0;f<d.length;f++){for(var g=[],h=0;h<d[f].values.length;h++)g.push(a.call(this,d[f].values[h]));g.sort(e);for(var i=1;i<g.length;i++)g[i]!==g[i-1]&&(c=Math.abs(g[i]-g[i-1]),b=void 0===b?c:b>c?c:b)}return b},a.DatasetManager.prototype.update_stack_values=function(a,b){var c=this.dataset,d=[];b||(b="zero");for(var e=0;e<c.length;e++)"stackedbar"===c[e].series_type&&c[e].visible&&d.push(c[e]);if(d.length>0){var f;"x"===a&&(f=d3.layout.stack().offset(b).values(function(a){return a.values}))(d),"y"===a&&(f=d3.layout.stack().offset(b).values(function(a){return a.values}).x(function(a){return a.y}).y(function(a){return a.x}).out(function(a,b,c){a.x0=b,a.x=c}))(d)}},a.DatasetManager.prototype.build_lookup_table=function(a){for(var b,c=this.dataset,d={},e=0;e<c.length;e++)if(c[e].visible)for(var f=0;f<c[e].values.length;f++)b=c[e].values[f][a],d.hasOwnProperty(b)||(d[b]=[]),c[e].values[f].series_name=c[e].name,c[e].values[f].series_num=e,d[b].push(c[e].values[f]);this["lookup_table_"+a]=d},a.DatasetManager.prototype.lookup=function(a,b,c){var d=this["lookup_table_"+a],e=d[b];if(!e&&c){var f=null,g=null;for(var h in d)d.hasOwnProperty(h)&&(b instanceof Date&&(h=new Date(h)),(null===f||Math.abs(h-b)<f)&&(f=Math.abs(h-b),g=h));e=d[g]}return e?e:[]},a.DatasetManager.prototype.get_axis_sum=function(a,b){var c,d,e=this["lookup_table_"+a],f={};for(var g in e)if(e.hasOwnProperty(g)){d=0,c=e[g];for(var h=0;h<c.length;h++)d+=e[g][h][b];f[g]=d}return f},a.DatasetManager.prototype.get_max=function(a){return d3.max(this.dataset.map(function(b){return b.visible?d3.max(b.values,function(b){return a(b)}):null}))},a.DatasetManager.prototype.get_min=function(a){return d3.min(this.dataset.map(function(b){return b.visible?d3.min(b.values,function(b){return a(b)}):null}))},a.DatasetManager.prototype.to_csv=function(a){void 0===a&&(a=this.dataset);var b,c,d,e,f,g,h,i=[["label","x","y","z"]],j="",k=function(a){return a};for(this.csv_auto_format?(f=this.chart.tooltip.xFormat||this.chart.xAxis.format||this.chart.aAxis.format||k,g=this.chart.tooltip.yFormat||this.chart.yAxis.format||this.chart.rAxis.format||k,h=this.chart.tooltip.zFormat||k):(f=k,g=k,h=k),d=0;d<a.length;d++)for(e=0;e<a[d].values.length;e++)b=[a[d].name],c=a[d].values[e],b.push(void 0!==c.x?f(c.x):""),b.push(void 0!==c.y?g(c.y):""),b.push(void 0!==c.z?h(c.z):""),i.push(b);for(d=0;d<i.length;d++)j+='"'+i[d].join('","')+'"\n';return j},a.DatasetManager.prototype.download_as_csv=function(b,c){void 0===c&&(c="data.csv");var d=d3.select("body").append("form").attr("method","POST").attr("action",a.options.csv_echo_path());d.append("input").attr("name","file_name").attr("value",c).attr("type","hidden"),d.append("input").attr("name","file_contents").attr("value",b).attr("type","hidden"),a.options.csrf_post_tag&&d.append("div").html(a.options.csrf_post_tag),d[0][0].submit(),d.remove()},a.DatasetLoader=function(a){this.chart=a,this.base_url=void 0,this.url_params={},this.dataset_filter=void 0},a.DatasetLoader.prototype.xhr_load=function(b){this.chart.overlay_loading instanceof a.Parts.OverlayLoading||(this.chart.overlay_loading=new a.Parts.OverlayLoading(this.chart,{})),this.chart.overlay_loading.render(!0);var c=this.setup_url(b,this.base_url);d3.json(c,function(a){this.dataset_filter&&(a=this.dataset_filter.apply(this,[a])),this.chart.set_dataset(a),this.chart.render(),this.chart.overlay_loading.render(!1)}.bind(this))},a.DatasetLoader.prototype.setup_url=function(b,c){c||(c=this.base_url),b=a.Util.merge(this.url_params,b);var d,e,f="",g=c.split("?"),h={};if(g[1]){d=g[1].split("&");for(var i=0;i<d.length;i++)e=d[i].split("="),h[e[0]]=e[1]}a.Util.merge(h,b);for(var j in h)h.hasOwnProperty(j)&&null!==h[j]&&(""!==f&&(f+="&"),f+=j+"="+h[j]);return g[0]+"?"+f},a.Util={},a.Util.merge=function(b,c){for(var d in c)c.hasOwnProperty(d)&&(b[d]=d in b?"object"==typeof b[d]&&"object"==typeof c[d]?a.Util.merge(b[d],c[d]):c[d]:c[d]);return b},a.Util.copy=function(b){if(null===b||void 0===b||"object"!=typeof b)return b;var c;if(b instanceof Date)return c=new Date,c.setTime(b.getTime()),c;if(b instanceof Array){c=[];for(var d=0,e=b.length;e>d;d++)c[d]=a.Util.copy(b[d]);return c}if(b instanceof Object){c={};for(var f in b)b.hasOwnProperty(f)&&(c[f]=a.Util.copy(b[f]));return c}throw new Error("Unable to copy obj! Its type isn't supported.")},a.Util.default_numeric_format=function(a){return d3.format(",.2s")(a)
},a.Util.default_date_format=function(a){return d3.time.format("%m/%d")(a)},a.Util.default_percent_format=function(a){return d3.format(",.1%")(a)},a.Util.each_data=function(a,b){for(var c=0,d=a.length;d>c;c++)for(var e=0,f=a[c].values.length;f>e;e++)b(a[c].values[e]);return a},a.Util.swap_dataset_xy=function(b){return a.Util.each_data(b,function(a){var b=a.x;a.x=a.y,a.y=b}),b},a.Util.dataset_from_array=function(a,b,c){c||(c={});var d,e,f,g,h,i=[];b instanceof Array||(b=[b]),c.header_row&&(h=a.shift());for(var j=0;j<b.length;j++){g=b[j],d=[];for(var k=0;k<a.length;k++)e={},void 0!==g.x&&(f=a[k][g.x],e.x=g.x_format?g.x_format(f):f),void 0!==g.y&&(f=a[k][g.y],e.y=g.y_format?g.y_format(f):f),void 0!==g.z&&(f=a[k][g.z],e.z=g.z_format?g.z_format(f):f),d.push(e);i.push({values:d})}return i},a.Util.extract_axis_text=function(a){return a.indexOf&&a.indexOf("___")>=0?a.split("___")[1]:a},a}();