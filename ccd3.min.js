var ccd3=function(){"use strict";var a={version:"0.9.0"};return a.get_instance=function(b){return"string"==typeof b?a.instances[b]:a.instances[d3.select(b.farthestViewportElement).attr("id")]},a.instances={},a.Chart=function(b,c){this.div_id=b,a.instances["svg_"+b]=this,this.series_container={},this.title={},this.xLabel={},this.yLabel={},this.xAxis={},this.yAxis={},this.zAxis={},this.legend={show:!0},this.tooltip={show:!0},this.zoom={use:!0},this.series=[],this.series_options={};for(var d in a.Parts.Series.type_info())this.series_options[d]={};this.dataset_manager={},this.initialized=!1,this.color_palette=void 0,this.height=320,this.width=480,this.chart_pattern=void 0,this.direction=void 0,this.show_values="onzoom",this.zoomed=!1,this.default_series_type="scatter",this.stack_type="zero",this.loader=new a.DatasetLoader(this),void 0!==c&&(this.dataset=c)},a.Chart.prototype.load=function(a){this.loader.load(a)},a.Chart.prototype.setup_options=function(b){return a.Util.merge(this,b)},a.Chart.prototype.render=function(b){if(void 0===b&&(b={}),this.initialized||this.init(),this.dataset_manager.update_stack_values(this.direction,this.stack_type),"xy"===this.chart_pattern){this.xAxis.reset_range(this.inner_width),this.yAxis.reset_range(this.inner_height),b.dont_reset_domain||(this.xAxis.reset_domain(),this.yAxis.reset_domain()),this.xAxis.render(),this.yAxis.render();var c=10;this.inner_width=this.width-this.yLabel.sizeof("width")-this.yAxis.sizeof("label_width")-c,this.legend.render(this.inner_width),this.legend.arrange(this.yAxis.sizeof("label_width")+this.yLabel.sizeof("width"),this.title.sizeof("height")),this.inner_height=this.height-this.title.sizeof("height")-this.legend.sizeof("height")-this.xAxis.sizeof("label_height")-this.xLabel.sizeof("height"),this.xAxis.arrange(this.yLabel.sizeof("width")+this.yAxis.sizeof("label_width"),this.height-this.xAxis.sizeof("label_height")-this.xLabel.sizeof("height")),this.yAxis.arrange(this.yLabel.sizeof("width")+this.yAxis.sizeof("label_width"),this.title.sizeof("height")+this.legend.sizeof("height")),this.series_container.render(this.inner_width,this.inner_height),this.series_container.arrange(this.yLabel.sizeof("width")+this.yAxis.sizeof("label_width"),this.title.sizeof("height")+this.legend.sizeof("height")),this.zoom instanceof a.Parts||this.zoom.use&&"ordinal"!==this.xAxis.scale_type&&"ordinal"!==this.yAxis.scale_type&&(this.zoom=new a.Parts.Zoom(this,this.zoom)),this.xAxis.reset_range(this.inner_width),this.yAxis.reset_range(this.inner_height),this.yAxis.render(),this.xAxis.render()}else"r"===this.chart_pattern&&(this.inner_width=this.width,this.inner_height=this.height-this.title.sizeof("height"),this.series_container.render(this.inner_width,this.inner_height),this.series_container.arrange(0,this.title.sizeof("height")));this.render_series()},a.Chart.prototype.init=function(){if(this.color_palette||(this.color_palette=["#3498db","#e74c3c","#2ecc71","#f1c40f","#e67e22","#1abc9c","#2980b9","#c0392b","#27ae60","#f39c12","#d35400","#16a085"]),this.dataset_manager instanceof a.DatasetManager||(this.dataset_manager=new a.DatasetManager(this)),this.dataset=this.dataset_manager.setup(this.dataset),this.setup_options(this.dataset_manager.options_from_dataset()),this.chart_pattern=this.dataset_manager.detect_chart_pattern(),void 0===this.svg&&(this.svg=d3.select("#"+this.div_id).append("svg").attr("id","svg_"+this.div_id).attr("class","ccd3").attr("width",this.width).attr("height",this.height)),this.inner_width=this.width,this.inner_height=this.height,this.init_parts(),this.title.render(),this.title.arrange(this.width/2,this.title.height/2),"xy"===this.chart_pattern){this.xLabel.render(),this.yLabel.render(),this.xLabel.arrange(this.width/2,this.height-this.xLabel.height/2),this.yLabel.arrange(this.yLabel.width/2,this.height/2),this.xAxis.scale_type=this.dataset_manager.detect_scale_type(function(a){return a.x}),this.xAxis.min_step=this.dataset_manager.calc_min_step(function(a){return a.x}),this.yAxis.scale_type=this.dataset_manager.detect_scale_type(function(a){return a.y}),this.yAxis.min_step=this.dataset_manager.calc_min_step(function(a){return a.y});var b=this.dataset_manager.has_directive_series_type();this.direction=b||"linear"!==this.yAxis.scale_type||"linear"!==this.xAxis.scale_type?"ordinal"===this.yAxis.scale_type||"date"===this.yAxis.scale_type?"y":"x":null,this.xAxis.init_scale(),this.yAxis.init_scale()}this.initialized=!0},a.Chart.prototype.init_parts=function(){this.series_container instanceof a.Parts||(this.series_container=new a.Parts.SeriesContainer(this,this.series_container)),this.tooltip instanceof a.Parts||(this.tooltip.show?this.tooltip=new a.Parts.Tooltip(this,this.tooltip):this.tooltip.add_listener=function(){}),this.title instanceof a.Parts||(this.title=void 0===this.title.text?new a.Parts(this,this.title):new a.Parts.Label.Title(this,this.title)),"xy"===this.chart_pattern&&(this.xLabel instanceof a.Parts||(this.xLabel=void 0===this.xLabel.text?new a.Parts(this,this.xLabel):new a.Parts.Label.xLabel(this,this.xLabel)),this.yLabel instanceof a.Parts||(this.yLabel=void 0===this.yLabel.text?new a.Parts(this,this.yLabel):new a.Parts.Label.yLabel(this,this.yLabel)),this.xAxis instanceof a.Parts||(this.xAxis=new a.Parts.Axis.xAxis(this,this.xAxis)),this.yAxis instanceof a.Parts||(this.yAxis=new a.Parts.Axis.yAxis(this,this.yAxis)),this.lgend instanceof a.Parts||(this.legend=this.legend.show?new a.Parts.Legend(this,this.legend):new a.Parts(this,this.legend)))},a.Chart.prototype.render_series=function(){var b,c,d,e,f=this.dataset;for(d=this.dataset.length,e=this.series.length,b=Math.max(d,e),c=0;b>c;c++)if(d>c){if(!(this.series[c]instanceof a.Parts.Series))switch(f[c].series_type){case"scatter":this.series[c]=new a.Parts.Series.Scatter(this,this.series_options.scatter);break;case"bar":this.series[c]=new a.Parts.Series.Bar(this,this.series_options.bar);break;case"stackedbar":this.series[c]=new a.Parts.Series.StackedBar(this,this.series_options.stackedbar);break;case"line":this.series[c]=new a.Parts.Series.Line(this,this.series_options.line);break;case"bubble":this.series[c]=new a.Parts.Series.Bubble(this,this.series_options.bubble);break;case"heatmap":this.series[c]=new a.Parts.Series.Heatmap(this,this.series_options.heatmap);break;case"pie":this.series[c]=new a.Parts.Series.Pie(this,this.series_options.pie)}this.series[c].init_svg(this.dataset[c])}else this.series[c].destroy();this.series.length=d,this.series_container.svg.selectAll(".ccd3_series").sort();var g=0;for(c=0;d>c;c++)"bar"===f[c].series_type&&f[c].visible&&g++;var h=0;for(c=0;d>c;c++)"bar"===f[c].series_type&&(this.series[c].render(g,h),f[c].visible&&h++);for(c=0;d>c;c++)"bar"!==f[c].series_type&&this.series[c].render()},a.Chart.prototype.destroy=function(){d3.select("#"+this.div_id).selectAll("*").remove(),d3.select("#tooltip_"+this.div_id).remove()},a.Chart.prototype._color=function(a){return this.color_palette[a%this.color_palette.length]},a.Parts=function(a,b){this.init(a,b)},a.Parts.prototype.get_defaults=function(){return{}},a.Parts.prototype.init=function(a,b){var c,d=this.get_defaults();this.chart=a;for(c in b)b.hasOwnProperty(c)&&(this[c]=b[c]);for(c in d)this.hasOwnProperty(c)||(this[c]=d[c])},a.Parts.prototype.render=function(){},a.Parts.prototype.sizeof=function(a){return isNaN(this[a])?0:this[a]},a.Parts.prototype.arrange=function(a,b){this.svg&&this.svg.attr("transform","translate("+a+","+b+")")},a.Parts.SeriesContainer=function(){a.Parts.apply(this,arguments)},a.Parts.SeriesContainer.prototype=new a.Parts,a.Parts.SeriesContainer.prototype.get_defaults=function(){return{height:0,width:0}},a.Parts.SeriesContainer.prototype.render=function(a,b){this.width=a,this.height=b,this.svg||(this.svg=this.chart.svg.append("g").attr("class","ccd3_series_container").attr("clip-path","url(#"+this.chart.div_id+"_clip)"),this.clip_path=this.chart.svg.append("defs").append("clipPath").attr("id",this.chart.div_id+"_clip"),this.clip_path.append("rect")),this.svg.attr("width",this.width).attr("height",this.height),this.clip_path.select("rect").attr("width",this.width).attr("height",this.height)},a.Parts.Label=function(){a.Parts.apply(this,arguments)},a.Parts.Label.prototype=new a.Parts,a.Parts.Label.prototype.get_defaults=function(){return{class_name:"ccd3_label",text:null,text_anchor:"middle",rotate:0,font_size:18,margin_top:5,margin_bottom:5,margin_right:5,margin_left:5,text_height:0,text_width:0,height:0,width:0}},a.Parts.Label.prototype.render=function(){void 0===this.svg&&(this.svg=this.chart.svg.append("g"),this.svg.attr("class",this.class_name).append("text").attr("text-anchor",this.text_anchor)),this.svg.select("text").text(this.text).attr("font-size",this.font_size).attr("transform","rotate("+this.rotate+")"),this.text_height=this.svg[0][0].getBBox().height,this.text_width=this.svg[0][0].getBBox().width,this.height=this.text_height+this.margin_bottom+this.margin_top,this.width=this.text_width+this.margin_right+this.margin_left},a.Parts.Label.Title=function(){a.Parts.Label.apply(this,arguments)},a.Parts.Label.Title.prototype=new a.Parts.Label,a.Parts.Label.Title.prototype.get_defaults=function(){return{class_name:"ccd3_title",font_size:18}},a.Parts.Label.xLabel=function(){a.Parts.Label.apply(this,arguments)},a.Parts.Label.xLabel.prototype=new a.Parts.Label,a.Parts.Label.xLabel.prototype.get_defaults=function(){return{class_name:"ccd3_xLabel",font_size:10,margin_top:20}},a.Parts.Label.yLabel=function(){a.Parts.Label.apply(this,arguments)},a.Parts.Label.yLabel.prototype=new a.Parts.Label,a.Parts.Label.yLabel.prototype.get_defaults=function(){return{class_name:"ccd3_yLabel",font_size:10,margin_right:20,rotate:90}},a.Parts.Legend=function(){a.Parts.apply(this,arguments)},a.Parts.Legend.prototype=new a.Parts,a.Parts.Legend.prototype.get_defaults=function(){return{show:!0,font_size:10,margin_top:3,margin_bottom:3,margin_left:5,margin_right:5,legend_height:0,height:0}},a.Parts.Legend.prototype.render=function(a){var b=this.chart.dataset,c=this;this.width=a;for(var d=[],e=0,f=b.length;f>e;e++)d.push(b[e].series_num);void 0===this.svg&&(this.svg=this.chart.svg.append("g").attr("class","svg_legend"));var g=this.svg.select(".legend_items");g.empty()&&(g=this.svg.append("g").attr("class","legend_items"));var h=g.selectAll("g").data(d);h.enter().append("g").attr("class","legend_item").attr("id",function(a){return"legend_item_"+a}).attr("cursor","pointer").on("click",function(){var a=d3.select(this).data();c.toggle_series(a)}).on("mouseover",function(){var a=d3.select(this).data();c.chart.series[a].highlight(!0)}).on("mouseout",function(){var a=d3.select(this).data();c.chart.series[a].highlight(!1)}).call(function(a){a.append("rect").attr("height","0.6em").attr("width","0.6em").attr("fill",function(a){return c.chart._color(a)}).attr("y","0.2em").attr("x","0.0em").attr("font-size",this.font_size)}).call(function(a){a.append("text").text(function(a,c){return b[c].name}).attr("y","0.8em").attr("x","0.8em").attr("font-size",this.font_size)}),h.select("rect").attr("visibility",function(a,c){return b[c].visible?"visible":"hidden"});var i=0,j=0,k=a;h.attr("transform",function(){var a=this.getBBox().height,b=this.previousSibling?this.previousSibling.getBBox().width:0;return i+2*(b+c.margin_right)<k?i+=b+c.margin_right:(i=c.margin_right,j+=a),"translate("+i+","+j+")"}),h.exit().remove(),this.legend_height=this.svg[0][0].getBBox().height,this.height=this.legend_height+this.margin_top+this.margin_bottom},a.Parts.Legend.prototype.toggle_series=function(a){var b=this.chart.dataset;b[a].visible=!b[a].visible,this.chart.svg.selectAll(".ccd3_brush_reset_button").remove(),this.chart.zoomed=!1,this.chart.render()},a.Parts.Tooltip=function(){a.Parts.apply(this,arguments),this.render()},a.Parts.Tooltip.prototype=new a.Parts,a.Parts.Tooltip.prototype.get_defaults=function(){return{show:!0,font_size:10}},a.Parts.Tooltip.prototype.render=function(){if(void 0===this.div){this.div=d3.select("body").append("div").attr("id","tooltip_"+this.chart.div_id).attr("class","ccd3_tooltip").style("opacity",0),this.svg=this.div,this.font_size&&this.div.style("font-size",this.font_size+"px")}},a.Parts.Tooltip.prototype.add_listener=function(b,c){var d=c;b.on("mouseover.tooltip",function(a){var b=d3.select(this.parentNode).data()[0]%1e3;d.div.html(d.chart.series[b].tooltip_html(a)).style("display",null).transition().duration(300).style("opacity",.8)}),b.on("mouseout.tooltip",function(){a.get_instance(this).tooltip.div.style("opacity",0).style("display","none")}),b.on("mousemove.tooltip",function(){a.get_instance(this).tooltip.div.style("top",d3.event.pageY-10+"px").style("left",d3.event.pageX+10+"px")})},a.Parts.Axis=function(){a.Parts.apply(this,arguments)},a.Parts.Axis.prototype=new a.Parts,a.Parts.Axis.prototype.get_defaults=function(){return{svg:null,axis:void 0,scale:void 0,scale_type:null,min_step:null,range_max:0,range_min:0,domain_max:void 0,domain_min:void 0,domain_margin:.1,domain_margin_type:void 0,band_padding:.2,format:void 0,show_label:!0,tick_num:void 0,tick_padding:5,font_size:10,label_width:0,label_height:0,margin_top:3,margin_bottom:3,margin_right:3,margin_left:3}},a.Parts.Axis.prototype.render=function(){},a.Parts.Axis.prototype.init_format=function(){if("date"===this.scale_type)this.format=a.Util.default_date_format();else if("linear"===this.scale_type)this.format=a.Util.default_numeric_format;else{if("ordinal"!==this.scale_type)throw new Error("Invalid scale_type");this.format=function(a){return a}}},a.Parts.Axis.prototype.init_scale=function(){if(!this.scale)switch(this.scale_type){case"date":this.scale=d3.time.scale();break;case"linear":this.scale=d3.scale.linear();break;case"ordinal":this.scale=d3.scale.ordinal()}},a.Parts.Axis.prototype.reset_range=function(a){this.range_max=a,"ordinal"===this.scale_type?this.scale.rangeRoundBands([this.range_min,this.range_max],this.band_padding):this.scale.range([this.range_min,this.range_max])},a.Parts.Axis.prototype.reset_domain=function(){var a,b,c,d=[],e=this.direction;if("ordinal"===this.scale_type){c=function(a){return a[e]};for(var f=0,g=this.chart.dataset.length;g>f;f++)d=d.concat(this.chart.dataset[f].values.map(c))}else"x"===e?c="date"===this.scale_type?function(a){return a.x}:function(a){return a.x+(void 0===a.x0?0:a.x0)}:"y"===e&&(c="date"===this.scale_type?function(a){return a.y}:function(a){return a.y+(void 0===a.y0?0:a.y0)}),a=this.chart.dataset_manager.get_min(c),b=this.chart.dataset_manager.get_max(c),void 0===a||void 0===b?(a=void 0,b=void 0):this.direction!==this.chart.direction&&"grid"!==this.domain_margin_type?(a>0&&a-(b-a)*this.domain_margin<0?a=0:a-=(b-a)*this.domain_margin,0>b&&b+(b-a)*this.domain_margin>0?b=0:b+=(b-a)*this.domain_margin):"date"===this.scale_type?(a=new Date(a.getTime()-this.min_step/2),b=new Date(b.getTime()+this.min_step/2)):"linear"===this.scale_type&&(a-=this.min_step/2,b+=this.min_step/2),void 0!==this.domain_min&&(a=this.domain_min),void 0!==this.domain_max&&(b=this.domain_max),d="x"===e||"y"===this.chart.direction?[a,b]:[b,a];this.scale.domain(d)},a.Parts.Axis.xAxis=function(){a.Parts.Axis.apply(this,arguments)},a.Parts.Axis.xAxis.prototype=new a.Parts.Axis,a.Parts.Axis.xAxis.prototype.get_defaults=function(){return{direction:"x"}},a.Parts.Axis.xAxis.prototype.render=function(){var a,b=this,c=(this.chart.inner_width,this.chart.inner_height);this.svg||(this.svg=this.chart.svg.append("g").attr("class","ccd3_xAxis")),void 0===this.format&&this.init_format(),a=this.show_label?this.format:function(){return""},this.axis=d3.svg.axis().scale(this.scale).tickSize(-1*c).orient("bottom").tickFormat(a),this.tick_num&&this.axis.ticks(this.tick_num),this.svg.call(this.axis).selectAll(".tick text").style("text-anchor","end").attr("class","ccd3_x_tick_label").attr("font-size",this.font_size).attr("transform",function(){return"translate("+this.getBBox().height*-.5+","+b.tick_padding+")rotate(-90)"}),this.text_height=d3.max(this.svg.selectAll(".ccd3_x_tick_label")[0].map(function(a){return a.getBBox().width})),this.label_height=this.text_height+this.margin_top+this.margin_bottom},a.Parts.Axis.yAxis=function(){a.Parts.Axis.apply(this,arguments)},a.Parts.Axis.yAxis.prototype=new a.Parts.Axis,a.Parts.Axis.yAxis.prototype.get_defaults=function(){return{direction:"y"}},a.Parts.Axis.yAxis.prototype.render=function(){{var a,b=this.chart.inner_width;this.chart.inner_height}this.svg||(this.svg=this.chart.svg.append("g").attr("class","ccd3_yAxis")),void 0===this.format&&this.init_format(),a=this.show_label?this.format:function(){return""},this.axis=d3.svg.axis().scale(this.scale).tickSize(-1*b).tickPadding(this.tick_padding).orient("left").tickFormat(a),this.tick_num&&this.axis.ticks(this.tick_num),this.svg.call(this.axis).selectAll(".tick text").attr("class","ccd3_y_tick_label").attr("font-size",this.font_size),this.text_width=d3.max(this.svg.selectAll(".ccd3_y_tick_label")[0].map(function(a){return a.getBBox().width})),this.label_width=this.text_width+this.margin_right+this.margin_left},a.Parts.Zoom=function(){a.Parts.apply(this,arguments),this.render()},a.Parts.Zoom.prototype=new a.Parts,a.Parts.Zoom.prototype.get_defaults=function(){return{use:!0}},a.Parts.Zoom.prototype.render=function(){if(void 0===this.svg){var a=this;this.brush=d3.svg.brush().x(this.chart.xAxis.scale).y(this.chart.yAxis.scale).on("brushend",function(){a.zoom()}),this.svg=this.chart.series_container.svg.append("g").attr("class","ccd3_brush").call(this.brush)}},a.Parts.Zoom.prototype.zoom=function(){if(!this.brush.empty()){var a=this,b=this.chart,c=this.brush.extent();b.zoomed=!0,b.xAxis.scale.domain([c[0][0],c[1][0]]),b.yAxis.scale.domain("y"===b.direction?[c[0][1],c[1][1]]:[c[1][1],c[0][1]]),b.render({dont_reset_domain:!0}),this.brush.clear(),b.svg.selectAll(".ccd3_brush").call(this.brush),b.series_container.svg.append("g").attr("cursor","pointer").attr("transform","translate("+this.chart.inner_width+",0)").attr("class","ccd3_brush_reset_button").call(function(a){a.append("rect").attr("height","1.6em").attr("width","7em").attr("y","0.3em").attr("x","-7.25em").attr("rx",5).attr("ry",5)}).call(function(a){a.append("text").text("clear zoom").attr("y","1.5em").attr("x","-6.5em")}).on("click",function(){a.reset_zoom()})}},a.Parts.Zoom.prototype.reset_zoom=function(){var a=this.chart;a.zoomed=!1,a.render(),a.series_container.svg.selectAll(".ccd3_brush_reset_button").remove()},a.Parts.Series=function(){a.Parts.apply(this,arguments)},a.Parts.Series.type_info=function(){return{heatmap:{zindex:1},bar:{zindex:2},stackedbar:{zindex:3},bubble:{zindex:4},line:{zindex:5},scatter:{zindex:6},pie:{zindex:0}}},a.Parts.Series.prototype=new a.Parts,a.Parts.Series.prototype.get_defaults=function(){return{class_name:"ccd3_series",series:void 0,data:void 0,show_values:!1,color:null,font_size:10}},a.Parts.Series.prototype.render=function(){},a.Parts.Series.prototype.init_svg=function(b){if(this.series=b,!this.svg){var c=a.Parts.Series.type_info();this.svg=this.chart.series_container.svg.append("g").attr("id","series_"+b.series_num).attr("class","series").attr("series_num",b.series_num).attr("series_name",b.name).attr("class",this.class_name).attr("series_type",b.series_type).datum(1e3*c[b.series_type].zindex+b.series_num)}},a.Parts.Series.prototype.destroy=function(){this.svg.remove()},a.Parts.Series.prototype.exit=function(a){a.exit().transition().duration(500).ease("linear").style("opacity",0).remove()},a.Parts.Series.prototype.get_data=function(){return this.series.visible?this.series.values:[]},a.Parts.Series.prototype.text_visibility=function(){return this.show_values||"always"===this.chart.show_values||this.chart.zoomed&&"onzoom"===this.chart.show_values?!0:!1},a.Parts.Series.prototype.highlight=function(){},a.Parts.Series.prototype.tooltip_html=function(a){var b="";return b+="<b>"+this.series.name+"</b>",b+="<br>x: "+this.chart.xAxis.format(a.x),b+="<br>y: "+this.chart.yAxis.format(a.y)},a.Parts.Series.Scatter=function(){a.Parts.Series.apply(this,arguments)},a.Parts.Series.Scatter.prototype=new a.Parts.Series,a.Parts.Series.Scatter.prototype.get_defaults=function(){return{point_radius:3,point_radius_highlight:5}},a.Parts.Series.Scatter.prototype.render=function(){var a=this,b=this.series.series_num,c=this.text_visibility(),d=this.chart.xAxis.scale,e=this.chart.yAxis.scale,f=this.chart.xAxis,g=this.chart.yAxis,h=this.chart.yAxis.format;this.color=this.chart._color(b);var i=this.svg.selectAll(".ccd3_circle_g").data(a.get_data());i.enter().append("g").attr("class","ccd3_circle_g").style("opacity",0).call(function(b){b.append("circle").attr("fill",a.color).attr("r",a.point_radius)}).call(function(a){a.append("text").attr("text-anchor","middle").attr("y","-0.5em").text(function(a){return h(a.y)})}).on("mouseover",function(){d3.select(this).select("circle").attr("r",a.point_radius_highlight)}).on("mouseout",function(){d3.select(this).select("circle").attr("r",a.point_radius)}).call(a.chart.tooltip.add_listener,a.chart.tooltip),i.transition().duration(500).attr("transform",function(a){var b,c;return b="ordinal"===f.scale_type?d(a.x)+d.rangeBand()/2:d(a.x),c="ordinal"===g.scale_type?e(a.y)+e.rangeBand()/2:e(a.y),"translate("+b+","+c+")"}).style("opacity",1).call(function(b){b.select("text").style("display",function(){return c?null:"none"}).attr("font-size",a.font_size)}),i.call(this.exit)},a.Parts.Series.Scatter.prototype.highlight=function(a){a?this.svg.selectAll(".ccd3_circle_g circle").attr("r",this.point_radius_highlight):this.svg.selectAll(".ccd3_circle_g circle").attr("r",this.point_radius)},a.Parts.Series.Bar=function(){a.Parts.Series.apply(this,arguments)},a.Parts.Series.Bar.prototype=new a.Parts.Series,a.Parts.Series.Bar.prototype.get_defaults=function(){return{opacity:.7}},a.Parts.Series.Bar.prototype.render=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o=this,p=this.series.series_num,q=this.text_visibility();this.color=this.chart._color(p),"x"===this.chart.direction?(c=this.chart.xAxis.scale,d=this.chart.yAxis.scale,g=this.chart.xAxis,f=this.chart.yAxis,e=this.chart.yAxis.format,n=this.chart.xAxis.band_padding):(c=this.chart.yAxis.scale,d=this.chart.xAxis.scale,g=this.chart.yAxis,f=this.chart.xAxis,e=this.chart.xAxis.format,n=this.chart.yAxis.band_padding),h="ordinal"===g.scale_type?c.rangeBand():Math.abs(c(g.min_step)-c(0));var r=h*(1-n)/a;"x"===this.chart.direction?(l=function(a){return a.y},j=function(){return r},k=function(a){return Math.abs(d(0)-d(a.y))},i=function(a){var e=c(a.x)+r*b+h*n/2;"ordinal"!==g.scale_type&&(e-=h/2);var f=Math.min(d(0),d(a.y));return"translate("+e+","+f+")"},m=function(){var a=r/2-this.getBBox().height/2,b=this.getBBox().height/2;return"translate("+a+","+b+") rotate(90)"}):(l=function(a){return a.x},j=function(a){return Math.abs(d(0)-d(a.x))},k=function(){return r},i=function(a){var e=c(a.y)+r*b+h*n/2;"ordinal"!==g.scale_type&&(e-=h/2);var f=Math.min(d(0),d(a.x));return"translate("+f+","+e+")"},m=function(a){var b=r/2+this.getBBox().height/2,c=d(a.x)-this.getBBox().width;return"translate("+c+","+b+")"});var s=this.svg.selectAll(".ccd3_bar_g").data(o.get_data());s.enter().append("g").attr("class","ccd3_bar_g").style("opacity",0).call(function(a){a.append("rect").attr("fill",o.color)}).call(function(a){a.append("text").text(function(a){return e(l(a))})}).on("mouseover",function(){d3.select(this).style("opacity",1)}).on("mouseout",function(){d3.select(this).style("opacity",o.opacity)}).call(o.chart.tooltip.add_listener,o.chart.tooltip),s.transition().duration(500).attr("transform",i).style("opacity",o.opacity).call(function(a){a.select("rect").attr("width",j).attr("height",k)}).call(function(a){a.select("text").attr("visibility",function(){return q?"visible":"hidden"}).attr("transform",m).attr("font-size",o.font_size)}),s.call(this.exit)},a.Parts.Series.Bar.prototype.highlight=function(a){a?this.svg.selectAll(".ccd3_bar_g").style("opacity",1):this.svg.selectAll(".ccd3_bar_g").style("opacity",this.opacity)},a.Parts.Series.StackedBar=function(){a.Parts.Series.apply(this,arguments)},a.Parts.Series.StackedBar.prototype=new a.Parts.Series,a.Parts.Series.StackedBar.prototype.get_defaults=function(){return{opacity:.7}},a.Parts.Series.StackedBar.prototype.render=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m=this,n=this.series.series_num,o=this.text_visibility();this.color=this.chart._color(n),"x"===this.chart.direction?(a=this.chart.xAxis.scale,b=this.chart.yAxis.scale,e=this.chart.xAxis,d=this.chart.yAxis,c=this.chart.yAxis.format,l=this.chart.xAxis.band_padding):(a=this.chart.yAxis.scale,b=this.chart.xAxis.scale,e=this.chart.yAxis,d=this.chart.xAxis,c=this.chart.xAxis.format,l=this.chart.yAxis.band_padding),f="ordinal"===e.scale_type?a.rangeBand():Math.abs(a(e.min_step)-a(0));var p=f*(1-l);"x"===this.chart.direction?(j=function(a){return a.y},h=function(){return p},i=function(a){return Math.abs(b(a.y0)-b(a.y+a.y0))},g=function(c){var d=a(c.x)+f*l/2;"ordinal"!==e.scale_type&&(d-=f/2);var g=Math.min(b(c.y0),b(c.y+c.y0));return"translate("+d+","+g+")"},k=function(){var a=p/2-this.getBBox().height/2,b=this.getBBox().height/2;return"translate("+a+","+b+") rotate(90)"}):(j=function(a){return a.x},h=function(a){return Math.abs(b(a.x0)-b(a.x+a.x0))},i=function(){return p},g=function(c){var d=a(c.y)+f*l/2;"ordinal"!==e.scale_type&&(d-=f/2);var g=Math.min(b(c.x0),b(c.x+c.x0));return"translate("+g+","+d+")"},k=function(a){var c=p/2+this.getBBox().height/2,d=b(a.x+a.x0)-b(a.x0)-this.getBBox().width-5;return"translate("+d+","+c+")"});var q=this.svg.selectAll(".ccd3_bar_g").data(m.get_data());q.enter().append("g").attr("class","ccd3_bar_g").style("opacity",0).call(function(a){a.append("rect").attr("fill",m.color)}).call(function(a){a.append("text").text(function(a){return c(j(a))}).attr("transform","rotate(90)")}).on("mouseover",function(){d3.select(this).style("opacity",1)}).on("mouseout",function(){d3.select(this).style("opacity",m.opacity)}).call(m.chart.tooltip.add_listener,m.chart.tooltip),q.transition().duration(500).attr("transform",g).style("opacity",m.opacity).call(function(a){a.select("rect").attr("width",h).attr("height",i)}).call(function(a){a.select("text").attr("visibility",function(){return o?"visible":"hidden"}).attr("transform",k).attr("font-size",m.font_size)}),q.call(this.exit)},a.Parts.Series.StackedBar.prototype.highlight=function(a){a?this.svg.selectAll(".ccd3_bar_g").style("opacity",1):this.svg.selectAll(".ccd3_bar_g").style("opacity",this.opacity)},a.Parts.Series.Line=function(){a.Parts.Series.apply(this,arguments)},a.Parts.Series.Line.prototype=new a.Parts.Series,a.Parts.Series.Line.prototype.get_defaults=function(){return{opacity:.7,line_width:1,line_width_highlight:3,point_radius:3,point_radius_highlight:5}},a.Parts.Series.Line.prototype.render=function(){var a=this,b=this.series.series_num,c=this.text_visibility(),d=this.chart.xAxis.scale,e=this.chart.yAxis.scale,f=this.chart.yAxis.format;this.color=this.chart._color(b);var g=this.series.visible?[0]:[],h=d3.svg.line().x(function(a){return d(a.x)}).y(function(a){return e(a.y)}).interpolate("linear"),i=this.svg.selectAll("path").data(g);i.enter().append("path").attr("class","series_path").attr("stroke",a.color).attr("stroke-width",a.line_width).attr("fill","none").style("opacity",0),i.transition().duration(500).attr("d",h(a.get_data())).style("opacity",a.opacity),i.call(this.exit);var j=this.svg.selectAll(".ccd3_circle_g").data(a.get_data());j.enter().append("g").attr("class","ccd3_circle_g").style("opacity",0).call(function(b){b.append("circle").attr("fill",a.color).attr("r",a.point_radius)}).call(function(a){a.append("text").attr("text-anchor","middle").attr("y","-0.5em").text(function(a){return f(a.y)})}).on("mouseover",function(){d3.select(this).select("circle").attr("r",a.point_radius_highlight),d3.select(this.parentNode).select(".series_path").attr("stroke-width",a.line_width_highlight)}).on("mouseout",function(){d3.select(this).select("circle").attr("r",a.point_radius),d3.select(this.parentNode).select(".series_path").attr("stroke-width",a.line_width)}).call(a.chart.tooltip.add_listener,a.chart.tooltip),j.transition().duration(500).attr("transform",function(a){return"translate("+d(a.x)+","+e(a.y)+")"}).style("opacity",1).call(function(b){b.select("text").style("display",function(){return c?null:"none"}).attr("font-size",a.font_size)}),j.call(this.exit)},a.Parts.Series.Line.prototype.highlight=function(a){a?(this.svg.selectAll(".ccd3_circle_g circle").attr("r",this.point_radius_highlight),this.svg.selectAll(".series_path").attr("stroke-width",this.line_width_highlight)):(this.svg.selectAll(".ccd3_circle_g circle").attr("r",this.point_radius),this.svg.selectAll(".series_path").attr("stroke-width",this.line_width))},a.Parts.Series.Bubble=function(){a.Parts.Series.apply(this,arguments)},a.Parts.Series.Bubble.prototype=new a.Parts.Series,a.Parts.Series.Bubble.prototype.get_defaults=function(){return{opacity:.7,max_radius:10,min_radius:3}},a.Parts.Series.Bubble.prototype.render=function(){var b=this,c=this.series.series_num,d=this.text_visibility(),e=this.chart.xAxis.scale,f=this.chart.yAxis.scale,g=this.chart.xAxis,h=this.chart.yAxis;if(this.zFormat=a.Util.default_numeric_format,this.color=this.chart._color(c),void 0===this.zScale){var i=this.chart.dataset_manager.get_max(function(a){return a.z}),j=this.chart.dataset_manager.get_min(function(a){return a.z});this.zScale=d3.scale.linear().range([this.min_radius,this.max_radius]).domain([j,i])}var k=this.zScale,l=this.svg.selectAll(".ccd3_bubble_g").data(b.get_data());l.enter().append("g").attr("class","ccd3_bubble_g").style("opacity",0).call(function(a){a.append("circle").attr("fill",b.color).attr("r",0)}).call(function(a){a.append("text").attr("text-anchor","middle").attr("y","0.4em").text(function(a){return b.zFormat(a.z)})}).on("mouseover",function(){d3.select(this).style("opacity",1)}).on("mouseout",function(){d3.select(this).style("opacity",b.opacity)}).call(b.chart.tooltip.add_listener,b.chart.tooltip),l.transition().duration(500).attr("transform",function(a){var b,c;return b="ordinal"===g.scale_type?e(a.x)+e.rangeBand()/2:e(a.x),c="ordinal"===h.scale_type?f(a.y)+f.rangeBand()/2:f(a.y),"translate("+b+","+c+")"}).style("opacity",b.opacity).call(function(a){a.select("circle").attr("r",function(a){return k(a.z)})}).call(function(a){a.select("text").attr("visibility",function(){return d?"visible":"hidden"}).attr("font-size",b.font_size)}),l.call(this.exit)},a.Parts.Series.Bubble.prototype.highlight=function(a){a?this.svg.selectAll(".ccd3_bubble_g").style("opacity",1):this.svg.selectAll(".ccd3_bubble_g").style("opacity",this.opacity)},a.Parts.Series.Bubble.prototype.tooltip_html=function(a){var b="";return b+="<b>"+this.series.name+"</b>",b+="<br>x: "+this.chart.xAxis.format(a.x),b+="<br>y: "+this.chart.yAxis.format(a.y),b+="<br>z: "+this.zFormat(a.z)},a.Parts.Series.Heatmap=function(){a.Parts.Series.apply(this,arguments)},a.Parts.Series.Heatmap.prototype=new a.Parts.Series,a.Parts.Series.Heatmap.prototype.get_defaults=function(){return{low_color:"red",high_color:"green"}},a.Parts.Series.Heatmap.prototype.render=function(){var b,c,d=this,e=this.series.series_num,f=this.text_visibility(),g=this.chart.xAxis.scale,h=this.chart.yAxis.scale,i=this.chart.xAxis,j=this.chart.yAxis;this.format=a.Util.default_numeric_format,this.color=this.chart._color(e);var k,l;if(b="ordinal"===i.scale_type?g.rangeBand():Math.abs(g(i.min_step)-g(0)),c="ordinal"===j.scale_type?h.rangeBand():Math.abs(h(j.min_step)-h(0)),b+=1,c+=1,void 0===this.cScale){var m=this.chart.dataset_manager.get_max(function(a){return a.z}),n=this.chart.dataset_manager.get_min(function(a){return a.z});this.cScale=d3.scale.linear().range([this.low_color,this.high_color]).domain([n,m]).interpolate(d3.interpolateHsl)}this.cScale;k=function(a){var d=g(a.x);"ordinal"!==i.scale_type&&(d-=b/2);var e=h(a.y);return"ordinal"!==j.scale_type&&(e-=c/2),"translate("+d+","+e+")"},l=function(){var a=b/2,d=c/2+this.getBBox().height/2;
return"translate("+a+","+d+")"};var o=this.svg.selectAll(".ccd3_rect_g").data(d.get_data());o.enter().append("g").attr("class","ccd3_rect_g").style("opacity",0).call(function(a){a.append("rect").attr("fill",function(a){return d.cScale(a.z)})}).call(function(a){a.append("text").attr("text-anchor","middle").text(function(a){return d.format(a.z)})}).call(d.chart.tooltip.add_listener,d.chart.tooltip),o.transition().duration(500).style("opacity",d.opacity).attr("transform",k).call(function(a){a.select("rect").attr("width",b).attr("height",c)}).call(function(a){a.select("text").attr("visibility",function(){return f?"visible":"hidden"}).attr("font-size",d.font_size).attr("transform",l)}),o.call(this.exit)},a.Parts.Series.Heatmap.prototype.tooltip_html=function(a){var b="";return b+="x: "+this.chart.xAxis.format(a.x),b+="<br>y: "+this.chart.yAxis.format(a.y),b+="<br>z: "+this.format(a.z)},a.Parts.Series.Pie=function(){a.Parts.Series.apply(this,arguments)},a.Parts.Series.Pie.prototype=new a.Parts.Series,a.Parts.Series.Pie.prototype.get_defaults=function(){return{inner_radius:0,radius_nofocus:.95,opacity:.7}},a.Parts.Series.Pie.prototype.render=function(){var b=this,c=Math.min(this.chart.inner_height,this.chart.inner_width)/2,d=d3.svg.arc().outerRadius(c*this.radius_nofocus).innerRadius(c*this.inner_radius);void 0===this.yFormat&&(this.yFormat=a.Util.default_numeric_format),void 0===this.pFormat&&(this.pFormat=d3.format(".1%"));var e=d3.layout.pie().sort(null).value(function(a){return a.y});this.svg.attr("transform",function(){return"translate("+b.chart.inner_width/2+","+b.chart.inner_height/2+")"});var f=e(this.get_data()),g=this.svg.selectAll(".ccd3_arc_g").data(f);g.enter().append("g").attr("class","ccd3_arc_g").style("opacity",this.opacity).on("mouseover",function(){d3.select(this).style("opacity",1).select("path").attr("d",function(a){return d.outerRadius(c),d(a)})}).on("mouseout",function(){d3.select(this).style("opacity",b.opacity).select("path").attr("d",function(a){return d.outerRadius(c*b.radius_nofocus),d(a)})}).call(b.chart.tooltip.add_listener,b.chart.tooltip).call(function(a){a.append("path").attr("d",d).style("fill",function(a,c){return b.chart._color(c)})}).call(function(a){a.append("text").attr("transform",function(a){return"translate("+d.centroid(a)+")"}).attr("dy",".35em").style("text-anchor","middle").call(function(a){a.append("tspan").attr("y","-1em").text(function(a){return a.data.x})}).call(function(a){a.append("tspan").attr("dy","1em").attr("x",0).text(function(a){return b.pFormat((a.endAngle-a.startAngle)/Math.PI/2)})}).call(function(a){a.append("tspan").attr("dy","1em").attr("x",0).text(function(a){return b.yFormat(a.data.y)})})}),g.call(this.exit)},a.Parts.Series.Pie.prototype.tooltip_html=function(a){var b="";return b+="<b>"+a.data.x+"</b>",b+="<br>%: "+this.pFormat((a.endAngle-a.startAngle)/Math.PI/2),b+="<br>value: "+this.yFormat(a.data.y)},a.DatasetManager=function(a){this.chart=a},a.DatasetManager.prototype.setup=function(b){var c,d,e=a.Parts.Series.type_info();for(this.dataset=a.Util.copy(b),this.dataset_original=a.Util.copy(b),b=this.dataset,c=0,d=b.length;d>c;c++)b[c].series_num=c,void 0===b[c].series_type&&(b[c].series_type=this.chart.default_series_type),void 0===b[c].name&&(b[c].name="series"+(c+1)),void 0===b[c].visible&&(b[c].visible=!0),void 0!==b[c].color&&(this.chart.color_palette[c]=b[c].color);var f=[];for(c=0,d=b.length;d>c;c++){if(void 0!==b[c].series_type&&!e.hasOwnProperty(b[c].series_type))throw new Error("invalid series_type");f.push(b[c].series_type)}if((f.indexOf("heatmap")>=0||f.indexOf("pie")>=0)&&f.length>1)throw new Error("If you use 'heatmap' or 'pie' series_type, you must set only one series in dataset.");if(f.indexOf("bar")>=0&&f.indexOf("stackedbar")>=0)throw new Error("You can't use 'bar' and 'stackedbar' series_type at the same time.");return b},a.DatasetManager.prototype.detect_chart_pattern=function(){return"pie"===this.dataset[0].series_type?"r":"xy"},a.DatasetManager.prototype.options_from_dataset=function(){var a={};return"heatmap"===this.dataset[0].series_type&&(a={legend:{show:!1},xAxis:{band_padding:0,domain_margin_type:"grid"},yAxis:{band_padding:0,domain_margin_type:"grid"}}),a},a.DatasetManager.prototype.has_directive_series_type=function(){for(var a=["bar","stackedbar","line"],b=0,c=this.dataset.length;c>b;b++)if(a.indexOf(this.dataset[b])>=0)return!0;return!1},a.DatasetManager.prototype.detect_scale_type=function(a){var b=a.call(this,this.dataset[0].values[0]);return b instanceof Date?"date":"number"==typeof b?"linear":"string"==typeof b?"ordinal":null},a.DatasetManager.prototype.calc_min_step=function(a){for(var b,c,d=this.dataset,e=function(a,b){return b-a},f=0;f<d.length;f++){for(var g=[],h=1;h<d[f].values.length;h++)g.push(a.call(this,d[f].values[h]));g.sort(e);for(var i=1;i<g.length;i++)g[i]!==g[i-1]&&(c=Math.abs(g[i]-g[i-1]),b=void 0===b?c:b>c?c:b)}return b},a.DatasetManager.prototype.update_stack_values=function(a,b){var c=this.dataset,d=[];b||(b="zero");for(var e=0;e<c.length;e++)"stackedbar"===c[e].series_type&&c[e].visible&&d.push(c[e]);if(d.length>0){var f;"x"===a&&(f=d3.layout.stack().offset(b).values(function(a){return a.values}))(d),"y"===a&&(f=d3.layout.stack().offset(b).values(function(a){return a.values}).x(function(a){return a.y}).y(function(a){return a.x}).out(function(a,b,c){a.x0=b,a.x=c}))(d)}},a.DatasetManager.prototype.get_max=function(a){return d3.max(this.dataset.map(function(b){return b.visible?d3.max(b.values,function(b){return a(b)}):null}))},a.DatasetManager.prototype.get_min=function(a){return d3.min(this.dataset.map(function(b){return b.visible?d3.min(b.values,function(b){return a(b)}):null}))},a.DatasetLoader=function(a){this.chart=a,this.source=void 0,this.params=void 0,this.before_filter=void 0,this.after_filter=void 0},a.DatasetLoader.prototype.load=function(b){if("function"==typeof this.source){var c=a.Util.merge(this.params,b);this.before_filter&&(c=this.before_filter.apply(this,[c]));var d=this.source.apply(this,[c]);this.after_filter&&(d=this.after_filter.apply(this,[d])),this.chart.dataset=d,this.chart.initialized=!1,this.chart.render()}else if("string"==typeof this.source){var e;b=a.Util.merge(this.params,b);var f=function(a,b){var c="";for(var d in b)""!==c&&(c+="&"),c+=d+"="+b[d];return a+"?"+c};e=this.before_filter?this.before_filter.apply(this,[this.source,b,f]):f(this.source,b),d3.json(e,function(a){this.after_filter&&(a=this.after_filter.apply(this,[a])),this.chart.dataset=a,this.chart.initialized=!1,this.chart.render()}.bind(this))}},a.Util={},a.Util.merge=function(b,c){for(var d in c)c.hasOwnProperty(d)&&(b[d]=d in b?"object"==typeof b[d]&&"object"==typeof c[d]?a.Util.merge(b[d],c[d]):c[d]:c[d]);return b},a.Util.copy=function(b){if(null===b||void 0===b||"object"!=typeof b)return b;var c;if(b instanceof Date)return c=new Date,c.setTime(b.getTime()),c;if(b instanceof Array){c=[];for(var d=0,e=b.length;e>d;d++)c[d]=a.Util.copy(b[d]);return c}if(b instanceof Object){c={};for(var f in b)b.hasOwnProperty(f)&&(c[f]=a.Util.copy(b[f]));return c}throw new Error("Unable to copy obj! Its type isn't supported.")},a.Util.default_numeric_format=function(a){var b=d3.formatPrefix(a);return""===b.symbol?1>a?d3.round(a,3):d3.round(a,2):d3.round(b.scale(a),2)+b.symbol},a.Util.default_date_format=function(){var a=d3.time.format.multi([["",function(a){return a.getMilliseconds()}],["",function(a){return a.getSeconds()}],["",function(a){return a.getMinutes()}],["",function(a){return a.getHours()}],["%m/%d",function(a){return a.getDay()&&1!=a.getDate()}],["%m/%d",function(a){return 1!=a.getDate()}],["%m/%d",function(a){return a.getMonth()}],["%Y",function(){return!0}]]);return a},a.Util.swap_dataset_xy=function(a){for(var b,c=0,d=a.length;d>c;c++)for(var e=0,f=a[c].values.length;f>e;e++)b=a[c].values[e].x,a[c].values[e].x=a[c].values[e].y,a[c].values[e].y=b;return a},a}();